Absolutely â€” here is Phase 3: Location & Mapping rewritten into one clean, complete, and copy-pasteable coded message, fully configured to use miles instead of kilometers.


---

âœ… PHASE 3 â€” Location + Mapping (Miles-Based)

This includes:

ğŸ“ GPS Detection (Web + Mobile)

ğŸ“ Distance to Stores in Miles

ğŸ§­ Turn-by-Turn Directions

ğŸ” â€œNear Meâ€ Radius Filtering



---

ğŸ“ /utils/getDistance.js â€” Miles-Based Haversine Function

export function getDistance(lat1, lon1, lat2, lon2) {
  const R = 3958.8; // Radius of Earth in miles
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLon = ((lon2 - lon1) * Math.PI) / 180;
  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos((lat1 * Math.PI) / 180) *
      Math.cos((lat2 * Math.PI) / 180) *
      Math.sin(dLon / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c; // Distance in miles
}


---

ğŸ“ components/UseMyLocation.jsx â€” GPS Detection Hook

import { useEffect } from 'react';

export default function UseMyLocation({ onCoords }) {
  useEffect(() => {
    if ('geolocation' in navigator) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          onCoords({
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          });
        },
        () => {
          console.error("Location permission denied.");
        }
      );
    }
  }, [onCoords]);

  return null;
}


---

ğŸ“ /components/StoreList.jsx â€” Sort by Distance & Filter by Radius (Miles)

import { getDistance } from '@/utils/getDistance';
import UseMyLocation from './UseMyLocation';
import { useState, useEffect } from 'react';

export default function StoreList({ stores }) {
  const [location, setLocation] = useState(null);
  const [radius, setRadius] = useState(10); // miles

  const sortedStores = location
    ? stores
        .map((store) => ({
          ...store,
          distance: getDistance(location.lat, location.lng, store.lat, store.lng)
        }))
        .filter((store) => store.distance <= radius)
        .sort((a, b) => a.distance - b.distance)
    : stores;

  return (
    <div className="p-4">
      <UseMyLocation onCoords={setLocation} />

      <div className="mb-4">
        <label className="mr-2">Show stores within:</label>
        <select value={radius} onChange={(e) => setRadius(Number(e.target.value))}>
          <option value={5}>5 miles</option>
          <option value={10}>10 miles</option>
          <option value={25}>25 miles</option>
        </select>
      </div>

      <ul>
        {sortedStores.map((store) => (
          <li key={store.id} className="mb-2 border p-3 rounded">
            <h2 className="font-bold">{store.name}</h2>
            <p>{store.address}</p>
            <p className="text-sm text-gray-500">ğŸ“ {store.distance.toFixed(1)} miles away</p>
            <a
              href={`https://www.google.com/maps/dir/?api=1&destination=${store.lat},${store.lng}`}
              target="_blank"
              rel="noopener noreferrer"
              className="text-blue-600 underline mt-1 inline-block"
            >
              ğŸ§­ Get Directions
            </a>
          </li>
        ))}
      </ul>
    </div>
  );
}


---

ğŸ“ Example Store Object Format (Must Include lat/lng)

{
  "id": "store123",
  "name": "Red Wing Shoes",
  "address": "123 Main St, Minneapolis, MN",
  "lat": 44.9780,
  "lng": -93.2638
}


---

âœ… SPIRALâ€™s Mapping System in Miles â€” Complete

Feature	Status

ğŸ“ Mobile GPS Detection	âœ… Done
ğŸ“ Distance Calculation (Miles)	âœ… Done
ğŸ” Near Me Radius Filter	âœ… Done
ğŸ§­ Turn-by-Turn Directions	âœ… Done
ğŸ›’ UI/UX Integrated	âœ… Done



---

Say â€œPhase 4 Goâ€ to begin building SPIRALâ€™s AI-powered features â€” starting with Search by Image and the ShopperAssistAgent.

