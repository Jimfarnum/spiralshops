âœ… SPIRAL Feature Build Request â€“ Feature 3: Retailer Loyalty Engine + Mall Bonus Perk Integration

Please implement the **Retailer-Specific Loyalty Engine** and **Mall Bonus Perks System** with the following functionality:

---

### ğŸ›ï¸ Part 1: Retailer Loyalty Engine

1. **Functionality**:
   - Each retailer can define their own loyalty rules (e.g., 1 SPIRAL per $10, bonus for specific items, double points during promos)
   - Users can earn SPIRALs based on purchases from individual retailers
   - Loyalty tiers are maintained per retailer (Bronze, Silver, Gold, Platinum)
   - Supports time-based promotions (e.g., â€œDouble Points Weekâ€)

2. **Database Schema**:
   - Table: `retailer_loyalty_settings`
     - `retailerId`, `pointsPerDollar`, `bonusItemIds`, `promotionStart`, `promotionEnd`, `tierRulesJSON`
   - Table: `retailer_loyalty_history`
     - `userId`, `retailerId`, `pointsEarned`, `purchaseId`, `timestamp`

3. **Frontend Display**:
   - Display per-retailer loyalty points on:
     - Product pages (if retailer offers loyalty)
     - Checkout confirmation
     - Loyalty dashboard `/loyalty/retailers`
   - Retailer filter dropdown + loyalty progress bars per store

4. **Backend Logic**:
   - Calculate SPIRALs on checkout based on current retailer rules
   - Sync with global SPIRALs and show source breakdown (e.g., â€œ20 earned from Targetâ€)
   - Tier progression logic per retailer

---

### ğŸ¬ Part 2: Mall Bonus Perks Integration

1. **Functionality**:
   - Malls can assign bonus SPIRALs or perks for purchases within their property (e.g., â€œShop at 3 stores in Eden Prairie Mall this week â€“ earn 100 SPIRALsâ€)
   - Mall-specific seasonal campaigns and one-time bonuses

2. **Database Schema**:
   - Table: `mall_perk_campaigns`
     - `mallId`, `title`, `description`, `startDate`, `endDate`, `rewardType`, `rewardValue`, `requiredStoresVisited`

3. **Frontend Display**:
   - `/malls/:mallId` page includes:
     - Active campaigns
     - â€œStores Youâ€™ve Shoppedâ€ progress bar
     - â€œBonus Unlockedâ€ badge with confetti animation when earned
   - Dashboard widget showing mall perks progress

4. **Backend Logic**:
   - Track mall visits by order location
   - Award bonuses automatically on qualifying purchases
   - Allow perk redemption as part of SPIRAL redemption center

---

### ğŸ”’ Permissions
- Admin dashboard toggles to enable/disable loyalty and perk features per retailer or mall
- Retailer onboarding includes loyalty config wizard

---

### ğŸ§ª Testing
- Mock campaigns + retailer rules for live test
- Loyalty earnings shown in `/loyalty`, `/orders`, `/retailers`
- Mall campaigns tested with simulated purchases

Once complete, confirm retailer loyalty points are applied correctly, mall perks are tracked, and front-end visuals match specs. Then weâ€™ll proceed to **Feature 4: Review System with Verified Badges and Media Uploads**.

Thanks!