import{r as v,j as e,e as c,f as te,B as G,Q as le,C as m,d as x,F as ie,J as oe,K as j,S as V,M as u,a as h,b as g,q as f}from"./index-sTi6BLPu.js";import{u as _}from"./useQuery-4av79AcX.js";import{P as de}from"./progress-Cf362TSq.js";import{A as b}from"./activity-_qjqvmcS.js";import{R as ne}from"./refresh-cw-bGZJGN_p.js";import{D as ce}from"./download-DcxnRBbC.js";import{S as Q}from"./store-fvM_Wsk5.js";import{T as N}from"./trending-up-CRcGIWQN.js";import{U as me}from"./users-n91sDYUr.js";import{Z as w}from"./zap-1vep6Tn5.js";import{k as xe,B as z,X as C,Y as S,l as he,P as X,R as y,p as ge,q as pe,T as $,m as Y,n as Z,o as je}from"./AreaChart-ym-ikvBO.js";import{C as J}from"./crown-lJXmlzyl.js";import{M as W}from"./map-pin-DZnENn3K.js";import{E as ue}from"./eye-BfDIBTgL.js";import"./index-D04l966U.js";var fe=xe({chartName:"BarChart",GraphicalChild:z,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:C},{axisType:"yAxis",AxisComp:S}],formatAxisMap:he});function Ie(){var E,M,I,B,O,U,F;const[n]=v.useState(1),[T,A]=v.useState(!1),[L,D]=v.useState(new Date),[r]=v.useState(()=>`mall-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),{data:a,isLoading:ee,refetch:se}=_({queryKey:[`/api/mall/${n}/analytics`,r],queryFn:async()=>{var l,i,P,H,K,q;const s=await fetch(`/api/mall/${n}/analytics?sessionId=${r}`);if(!s.ok)throw new Error("Failed to fetch analytics");const t=await s.json();return{...t,topStores:((l=t.topStores)==null?void 0:l.map((o,d)=>({...o,id:`store-${r}-${d}`})))||[],revenueByCategory:((i=t.revenueByCategory)==null?void 0:i.map((o,d)=>({...o,id:`category-${r}-${d}`})))||[],footTrafficByHour:((P=t.footTrafficByHour)==null?void 0:P.map((o,d)=>({...o,id:`hour-${r}-${d}`})))||[],loyaltyMetrics:{...t.loyaltyMetrics,topEarners:((K=(H=t.loyaltyMetrics)==null?void 0:H.topEarners)==null?void 0:K.map((o,d)=>({...o,id:`earner-${r}-${d}`})))||[]},systemAlerts:((q=t.systemAlerts)==null?void 0:q.map((o,d)=>({...o,id:`alert-${r}-${d}`})))||[]}},refetchInterval:3e4}),{data:R}=_({queryKey:["/api/live-orders",n,r],queryFn:async()=>{const s=await fetch(`/api/live-orders?mallId=${n}&limit=10&sessionId=${r}`);if(!s.ok)throw new Error("Failed to fetch live orders");return(await s.json()).map((l,i)=>({...l,id:`order-${r}-${i}`}))},refetchInterval:5e3}),re=async()=>{A(!0),await se(),D(new Date),setTimeout(()=>A(!1),1e3)},ae=async()=>{try{const t=await(await fetch(`/api/mall/${n}/analytics/export?sessionId=${r}`)).blob(),l=window.URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=`mall-analytics-${n}-${r}.csv`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(l),document.body.removeChild(i)}catch(s){console.error("Export failed:",s)}},p=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),k=["#006d77","#ff9f1c","#e9c46a","#f4a261","#e76f51","#2a9d8f","#264653"];return ee?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 p-6",id:`loading-${r}`,children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 rounded-xl w-1/2"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[1,2,3,4].map(s=>e.jsx("div",{className:"h-32 bg-gradient-to-br from-gray-200 to-gray-300 rounded-xl"},`skeleton-${s}`))})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 p-6",id:`mall-analytics-${r}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-8",id:`header-${r}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"ðŸ¬ Enhanced Mall Analytics Dashboard"}),e.jsxs("p",{className:"text-slate-600 text-lg",children:["Mall ID: ",e.jsx("code",{className:"bg-slate-100 px-2 py-1 rounded text-sm",children:n})," | Session: ",e.jsx("code",{className:"bg-slate-100 px-2 py-1 rounded text-sm",children:r})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),"Live Updates Every 30s"]}),e.jsxs(c,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Last: ",L.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(G,{onClick:re,disabled:T,className:"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg",id:`refresh-btn-${r}`,children:[e.jsx(ne,{className:`h-4 w-4 mr-2 ${T?"animate-spin":""}`}),"Refresh"]}),e.jsxs(G,{onClick:ae,variant:"outline",className:"border-2 border-purple-500 text-purple-600 hover:bg-purple-500 hover:text-white",id:`export-btn-${r}`,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Export Data"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",id:`kpi-grid-${r}`,children:[{title:"Total Revenue",value:p((a==null?void 0:a.totalRevenue)||0),icon:le,change:"+18.2%",color:"from-green-500 to-emerald-600",bgColor:"bg-green-50",id:`kpi-revenue-${r}`},{title:"Active Stores",value:((E=a==null?void 0:a.totalStores)==null?void 0:E.toLocaleString())||"0",icon:Q,change:"+5 this month",color:"from-blue-500 to-cyan-600",bgColor:"bg-blue-50",id:`kpi-stores-${r}`},{title:"Total Orders",value:((M=a==null?void 0:a.totalOrders)==null?void 0:M.toLocaleString())||"0",icon:b,change:"+22.5%",color:"from-purple-500 to-violet-600",bgColor:"bg-purple-50",id:`kpi-orders-${r}`},{title:"Avg Order Value",value:p((a==null?void 0:a.avgOrderValue)||0),icon:N,change:"+12.1%",color:"from-orange-500 to-red-600",bgColor:"bg-orange-50",id:`kpi-aov-${r}`}].map(s=>e.jsx(m,{className:"border-0 shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden",id:s.id,children:e.jsxs(x,{className:"p-0",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${s.color}`}),e.jsxs("div",{className:`p-6 ${s.bgColor}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-r ${s.color} shadow-lg`,children:e.jsx(s.icon,{className:"h-6 w-6 text-white"})}),e.jsxs(c,{variant:"secondary",className:"bg-white/70 text-slate-700",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),s.change]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-600 mb-1",children:s.title}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:s.value})]})]})]})},s.id))}),e.jsxs(ie,{defaultValue:"overview",className:"space-y-6",id:`analytics-tabs-${r}`,children:[e.jsxs(oe,{className:"grid w-full grid-cols-5 bg-white border-2 border-slate-200 p-1 rounded-xl shadow-sm",children:[e.jsxs(j,{value:"overview",className:"data-[state=active]:bg-indigo-600 data-[state=active]:text-white rounded-lg",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Overview"]}),e.jsxs(j,{value:"stores",className:"data-[state=active]:bg-indigo-600 data-[state=active]:text-white rounded-lg",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Stores"]}),e.jsxs(j,{value:"traffic",className:"data-[state=active]:bg-indigo-600 data-[state=active]:text-white rounded-lg",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Traffic"]}),e.jsxs(j,{value:"loyalty",className:"data-[state=active]:bg-indigo-600 data-[state=active]:text-white rounded-lg",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Loyalty"]}),e.jsxs(j,{value:"live",className:"data-[state=active]:bg-indigo-600 data-[state=active]:text-white rounded-lg",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Live Feed"]})]}),e.jsx(u,{value:"overview",className:"space-y-6",id:`overview-tab-${r}`,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{className:"border-0 shadow-lg",id:`revenue-chart-${r}`,children:[e.jsxs(h,{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-t-xl",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Revenue by Category"]}),e.jsx(f,{className:"text-indigo-100",children:"Mall revenue distribution across categories"})]}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-indigo-50 to-purple-50",children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(X,{children:[e.jsx(ge,{data:(a==null?void 0:a.revenueByCategory)||[],cx:"50%",cy:"50%",outerRadius:100,innerRadius:40,paddingAngle:5,dataKey:"percentage",label:({category:s,percentage:t})=>`${s} ${t}%`,children:((a==null?void 0:a.revenueByCategory)||[]).map((s,t)=>e.jsx(pe,{fill:k[t%k.length]},`cell-${s.id||t}`))}),e.jsx($,{formatter:(s,t,l)=>[`${s}% (${p(l.payload.revenue)})`,l.payload.category],contentStyle:{backgroundColor:"white",border:"2px solid #6366f1",borderRadius:"12px"}})]})})})]}),e.jsxs(m,{className:"border-0 shadow-lg",id:`traffic-chart-${r}`,children:[e.jsxs(h,{className:"bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-t-xl",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Foot Traffic by Hour"]}),e.jsx(f,{className:"text-green-100",children:"Hourly visitor patterns throughout the day"})]}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-green-50 to-teal-50",children:e.jsx(y,{width:"100%",height:300,children:e.jsxs(Y,{data:(a==null?void 0:a.footTrafficByHour)||[],children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:`trafficGradient-${r}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:.1})]})}),e.jsx(Z,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(C,{dataKey:"hour",stroke:"#64748b"}),e.jsx(S,{stroke:"#64748b"}),e.jsx($,{contentStyle:{backgroundColor:"white",border:"2px solid #10b981",borderRadius:"12px"},formatter:s=>[`${s} visitors`,"Traffic"],labelFormatter:s=>`${s}:00`}),e.jsx(je,{type:"monotone",dataKey:"visitors",stroke:"#10b981",strokeWidth:2,fill:`url(#trafficGradient-${r})`})]})})})]})]})}),e.jsx(u,{value:"stores",className:"space-y-6",id:`stores-tab-${r}`,children:e.jsxs(m,{className:"border-0 shadow-lg",id:`top-stores-${r}`,children:[e.jsxs(h,{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-t-xl",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Top Performing Stores"]}),e.jsx(f,{className:"text-blue-100",children:"Store performance rankings and growth metrics"})]}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-blue-50 to-cyan-50",children:e.jsx("div",{className:"space-y-4",children:((a==null?void 0:a.topStores)||[]).map((s,t)=>{var l;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-xl shadow-sm border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-full w-12 h-12 flex items-center justify-center font-bold",children:["#",t+1]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.orders," orders"]}),e.jsxs(c,{variant:s.growth>0?"default":"secondary",className:"mt-1",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),s.growth>0?"+":"",s.growth,"%"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900",children:p(s.revenue)}),e.jsx(de,{value:s.revenue/(((l=a==null?void 0:a.topStores[0])==null?void 0:l.revenue)||1)*100,className:"w-24 mt-2"})]})]},s.id||`store-${t}`)})})})]})}),e.jsx(u,{value:"traffic",className:"space-y-6",id:`traffic-tab-${r}`,children:e.jsxs(m,{className:"border-0 shadow-lg",id:`traffic-details-${r}`,children:[e.jsxs(h,{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-t-xl",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Detailed Traffic Analysis"]}),e.jsx(f,{className:"text-orange-100",children:"Comprehensive visitor flow and patterns"})]}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-orange-50 to-red-50",children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(fe,{data:(a==null?void 0:a.footTrafficByHour)||[],children:[e.jsx(Z,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(C,{dataKey:"hour",stroke:"#64748b"}),e.jsx(S,{stroke:"#64748b"}),e.jsx($,{contentStyle:{backgroundColor:"white",border:"2px solid #ea580c",borderRadius:"12px"},formatter:s=>[`${s} visitors`,"Traffic"],labelFormatter:s=>`${s}:00`}),e.jsx(z,{dataKey:"visitors",fill:"#ea580c",radius:[4,4,0,0]})]})})})]})}),e.jsx(u,{value:"loyalty",className:"space-y-6",id:`loyalty-tab-${r}`,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(m,{className:"border-0 shadow-lg",id:`loyalty-stats-${r}`,children:[e.jsx(h,{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-t-xl",children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Loyalty Program Stats"]})}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-purple-50 to-pink-50",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:(B=(I=a==null?void 0:a.loyaltyMetrics)==null?void 0:I.totalMembers)==null?void 0:B.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Members"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-pink-600",children:(U=(O=a==null?void 0:a.loyaltyMetrics)==null?void 0:O.pointsIssued)==null?void 0:U.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"Points Issued"})]})]})})]}),e.jsxs(m,{className:"border-0 shadow-lg",id:`top-earners-${r}`,children:[e.jsx(h,{className:"bg-gradient-to-r from-yellow-600 to-orange-600 text-white rounded-t-xl",children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Top SPIRAL Earners"]})}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-yellow-50 to-orange-50",children:e.jsx("div",{className:"space-y-3",children:(((F=a==null?void 0:a.loyaltyMetrics)==null?void 0:F.topEarners)||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-bold",children:t+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx(c,{variant:"outline",children:s.tier})]})]}),e.jsxs("p",{className:"font-bold text-orange-600",children:[s.points.toLocaleString()," pts"]})]},s.id||`earner-${t}`))})})]})]})}),e.jsx(u,{value:"live",className:"space-y-6",id:`live-tab-${r}`,children:e.jsxs(m,{className:"border-0 shadow-lg",id:`live-orders-${r}`,children:[e.jsxs(h,{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-t-xl",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"Live Order Activity"]}),e.jsx(f,{className:"text-green-100",children:"Real-time orders across all mall stores"})]}),e.jsx(x,{className:"p-6 bg-gradient-to-br from-green-50 to-emerald-50",children:e.jsx("div",{className:"space-y-4",children:(R||[]).length>0?(R||[]).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white rounded-xl shadow-sm border-l-4 border-green-500",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-full w-10 h-10 flex items-center justify-center",children:e.jsx(b,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.customer_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.item_count," items"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-green-600",children:p(s.amount)}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})]})]},s.id||`order-${t}`)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No live orders currently. Orders will appear here in real-time."})]})})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6",id:`footer-${r}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"Enhanced UI Active"]}),e.jsxs(c,{variant:"outline",className:"bg-purple-50 text-purple-700 border-purple-200",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Session: ",r.split("-").pop()]}),e.jsxs(c,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Mall ID: ",n]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Last updated: ",L.toLocaleTimeString()]})]})})]})})}export{Ie as default};
