import{r as o,j as e,B as c,f as U,X as C,C as S,d as R,a as $,b as B,e as p}from"./index-sTi6BLPu.js";import{C as F}from"./check-Cok4To_4.js";import{R as D}from"./rotate-ccw-CuaGVkuT.js";function L(){const[h,P]=o.useState([]),[k,m]=o.useState(!0),[t,x]=o.useState("pending");async function l(){m(!0);try{const n=await(await fetch(`/api/admin/reviews?status=${t}`)).json();P(n.items||[])}catch(s){console.error("Failed to load reviews:",s)}m(!1)}o.useEffect(()=>{l()},[t]);async function A(s,n){try{await fetch(`/api/admin/review/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:n})}),l()}catch(r){console.error("Failed to approve:",r)}}async function T(s,n){try{await fetch(`/api/admin/review/${s}/deny`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:n})}),l()}catch(r){console.error("Failed to deny:",r)}}async function O(s,n,r){try{await fetch(`/api/admin/review/${s}/reclassify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:n,notes:r})}),l()}catch(d){console.error("Failed to reclassify:",d)}}return k?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Retailer Reviews"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:t==="pending"?"default":"outline",onClick:()=>x("pending"),className:"gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Pending (",h.filter(s=>s.status==="pending").length,")"]}),e.jsxs(c,{variant:t==="approved"?"default":"outline",onClick:()=>x("approved"),className:"gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Approved"]}),e.jsxs(c,{variant:t==="rejected"?"default":"outline",onClick:()=>x("rejected"),className:"gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Rejected"]})]})]}),h.length===0&&e.jsx(S,{children:e.jsxs(R,{className:"p-6 text-center text-gray-500",children:["No ",t," retailer submissions found."]})}),h.map(s=>{var n,r,d,j,f,g,u,v,N,y,b,w;return e.jsxs(S,{className:"border-l-4 border-l-blue-500",children:[e.jsx($,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-xl",children:(n=s.retailer)==null?void 0:n.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:(r=s.retailer)==null?void 0:r.address}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(d=s.retailer)==null?void 0:d.email," â€¢ ",(j=s.retailer)==null?void 0:j.phone]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:s.status==="approved"?"default":s.status==="rejected"?"destructive":"secondary",children:s.status}),e.jsx(p,{variant:"outline",children:(f=s.ai)==null?void 0:f.decision})]})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Business Description"}),e.jsx("p",{className:"text-sm bg-gray-50 p-3 rounded",children:(g=s.input)==null?void 0:g.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Selected Category"}),e.jsx("p",{className:"text-sm",children:(u=s.input)==null?void 0:u.selectedCategory})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"AI Suggestion"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:(v=s.ai)==null?void 0:v.suggestedCategory}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",Math.round((((N=s.ai)==null?void 0:N.confidence)||0)*100),"% confidence)"]})]})]})]}),((y=s.input)==null?void 0:y.photoUrls)&&s.input.photoUrls.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold mb-2",children:["Photos (",s.input.photoUrls.length,")"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:s.input.photoUrls.map((a,i)=>e.jsx("img",{src:a,alt:`Store photo ${i+1}`,className:"w-20 h-20 object-cover rounded border"},i))})]}),((b=s.ai)==null?void 0:b.verification)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Verification Status"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:s.ai.verification.onlinePresenceFound?"default":"secondary",children:s.ai.verification.onlinePresenceFound?"Presence Found":"No Presence"}),s.ai.verification.signals.map((a,i)=>e.jsx(p,{variant:"outline",children:a},i))]})]}),t==="pending"&&e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsxs(c,{onClick:()=>{var a;return A(s._id,(a=s.ai)==null?void 0:a.suggestedCategory)},className:"gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(F,{className:"w-4 h-4"}),"Approve"]}),e.jsxs(c,{variant:"outline",onClick:()=>{var i;const a=prompt("New category:",((i=s.ai)==null?void 0:i.suggestedCategory)||"Specialty & Unique Finds");a&&O(s._id,a,"Admin reclassification")},className:"gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Reclassify"]}),e.jsxs(c,{variant:"destructive",onClick:()=>{const a=prompt("Reason for denial:","Not permitted on platform");a&&T(s._id,a)},className:"gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),"Deny"]})]}),((w=s.admin)==null?void 0:w.notes)&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Admin Notes"}),e.jsx("p",{className:"text-sm mt-1",children:s.admin.notes}),s.admin.reviewer&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Reviewed by ",s.admin.reviewer," on ",new Date(s.updatedAt).toLocaleDateString()]})]})]})]},s._id)})]})}export{L as default};
