import{u as ee,U as se,r as g,j as e,C as r,a as l,b as n,q as m,d as t,I as B,B as y,e as w,S as ae}from"./index-sTi6BLPu.js";import{u as ie}from"./useQuery-4av79AcX.js";import{u as E}from"./useMutation-DaiJly-X.js";import{L as G}from"./label-DXgakF6_.js";import{S as re}from"./separator-BcewAmr9.js";import{C as S}from"./camera-D0xJbwXJ.js";import{L as O}from"./loader-circle-DeSCpGTb.js";import{E as te}from"./eye-BfDIBTgL.js";import{M as x}from"./map-pin-DZnENn3K.js";import{S as V}from"./search-BDvTlR0f.js";import{N as le}from"./navigation-C4cgsc30.js";import{S as $}from"./shopping-bag-B6bbBeT-.js";import{S as D}from"./sparkles-BuZ9UEHA.js";function ne({className:q}){var L,k,I,U,T,M,R;const{toast:c}=ee();se();const[C,J]=g.useState(null),[a,Q]=g.useState(null),[d,F]=g.useState(null),[P,_]=g.useState(null),[N,H]=g.useState(25),f=E({mutationFn:async s=>{const i=new FormData;i.append("image",s);const o=await fetch("/api/visual-search/analyze",{method:"POST",body:i});if(!o.ok)throw new Error("Failed to analyze image");return o.json()},onSuccess:s=>{var i;s.success&&(Q(s.data.analysis),c({title:"Image analyzed successfully",description:`Found ${s.data.analysis.productType} with ${((i=s.data.analysis.keywords)==null?void 0:i.length)||0} keywords`}))},onError:s=>{c({title:"Analysis failed",description:s.message,variant:"destructive"})}}),h=E({mutationFn:async({analysis:s,userLat:i,userLng:o,radius:u})=>{const p=await fetch("/api/visual-search/search-nearby",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({analysis:s,userLat:i,userLng:o,radius:u})});if(!p.ok)throw new Error("Failed to search nearby stores");return p.json()},onSuccess:s=>{s.success&&c({title:"Search complete",description:`Found ${s.data.nearbyStores.length} relevant stores nearby`})}}),{data:v}=ie({queryKey:["similar-products",a],queryFn:()=>a?fetch("/api/visual-search/similar-products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({analysis:a,limit:10})}).then(s=>s.json()):null,enabled:!!a}),K=s=>{var o;const i=(o=s.target.files)==null?void 0:o[0];if(i){if(i.size>10*1024*1024){c({title:"File too large",description:"Please select an image smaller than 10MB",variant:"destructive"});return}J(i);const u=new FileReader;u.onload=p=>{var z;_((z=p.target)==null?void 0:z.result)},u.readAsDataURL(i)}},W=()=>{C&&f.mutate(C)},Y=()=>{if(!navigator.geolocation){c({title:"Geolocation not supported",description:"Your browser doesn't support location services",variant:"destructive"});return}navigator.geolocation.getCurrentPosition(s=>{const i={lat:s.coords.latitude,lng:s.coords.longitude};F(i),c({title:"Location found",description:`Located within ${s.coords.accuracy}m accuracy`})},()=>{F({lat:44.9537,lng:-93.09}),c({title:"Using demo location",description:"Using Minneapolis, MN as demo location"})})},X=()=>{!a||!d||h.mutate({analysis:a,userLat:d.lat,userLng:d.lng,radius:N})},Z=s=>{window.open(s.directionsUrl,"_blank")},b=((k=(L=h.data)==null?void 0:L.data)==null?void 0:k.nearbyStores)||[],j=(U=(I=h.data)==null?void 0:I.data)==null?void 0:U.suggestions,A=((T=v==null?void 0:v.data)==null?void 0:T.products)||[];return e.jsxs("div",{className:`space-y-6 ${q}`,children:[e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Visual Product Search"]}),e.jsx(m,{children:"Upload an image to find similar products and nearby stores"})]}),e.jsx(t,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(G,{htmlFor:"image-upload",children:"Select Image"}),e.jsx(B,{id:"image-upload",type:"file",accept:"image/*",onChange:K,className:"mt-1"})]}),P&&e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("img",{src:P,alt:"Preview",className:"max-w-xs max-h-48 object-contain rounded-lg border"}),e.jsx(y,{onClick:W,disabled:f.isPending,className:"w-full",children:f.isPending?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Analyze Image"]})})]})]})})]}),a&&e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(n,{children:"Analysis Results"}),e.jsx(m,{children:"AI-powered product identification and categorization"})]}),e.jsxs(t,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Product Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",a.productType]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",a.category]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Style:"})," ",a.style]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",a.gender]}),a.price_range&&e.jsxs("div",{children:[e.jsx("strong",{children:"Est. Price:"})," ",a.price_range]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Keywords & Features"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:(M=a.keywords)==null?void 0:M.map((s,i)=>e.jsx(w,{variant:"secondary",className:"text-xs",children:s},i))}),((R=a.colors)==null?void 0:R.length)>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Colors:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.colors.map((s,i)=>e.jsx(w,{variant:"outline",className:"text-xs",children:s},i))})]})]})]})]}),e.jsx(re,{}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-gray-600",children:a.description})})]})]}),a&&e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Find Nearby Stores"]}),e.jsx(m,{children:"Search for stores that might carry similar items"})]}),e.jsxs(t,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[d?e.jsxs("div",{className:"text-sm text-gray-600",children:["Location: ",d.lat.toFixed(4),", ",d.lng.toFixed(4)]}):e.jsxs(y,{onClick:Y,variant:"outline",children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Get My Location"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{htmlFor:"radius",children:"Radius:"}),e.jsx(B,{id:"radius",type:"number",value:N,onChange:s=>H(parseInt(s.target.value)),className:"w-20",min:"1",max:"50"}),e.jsx("span",{className:"text-sm text-gray-600",children:"miles"})]})]}),d&&e.jsx(y,{onClick:X,disabled:h.isPending,className:"w-full",children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Search Nearby Stores"]})})]})]}),b.length>0&&e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(n,{children:["Nearby Stores (",b.length,")"]}),e.jsxs(m,{children:["Stores that might carry similar items within ",N," miles"]})]}),e.jsxs(t,{children:[e.jsx("div",{className:"space-y-3",children:b.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium",children:s.name}),s.isVerified&&e.jsx(w,{variant:"secondary",className:"text-xs",children:"âœ“ Verified"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.category}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:s.address}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3"}),s.distance,"mi away"]}),parseFloat(s.rating)>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3 text-yellow-500 fill-current"}),s.rating]})]})]}),e.jsxs(y,{size:"sm",onClick:()=>Z(s),children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Directions"]})]})},s.id))}),j&&e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h5",{className:"font-medium mb-2",children:"Search Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Availability:"})," ",j.estimatedAvailability]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Relevant Stores:"})," ",j.relevantStores]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Nearby:"})," ",j.totalNearbyStores]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",j.categoryMatch]})]})]})]})]}),A.length>0&&e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Similar Products"]}),e.jsx(m,{children:"Products matching your image analysis"})]}),e.jsx(t,{children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(s=>e.jsxs("div",{className:"border rounded-lg p-3 hover:shadow-md transition-shadow",children:[e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-32 object-cover rounded mb-3"}),e.jsx("h4",{className:"font-medium mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.category}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-semibold",children:["$",s.price]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.storeName})]})]},s.id))})})]})]})}function ve(){return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"Visual Product Search"}),e.jsx("p",{className:"text-xl text-gray-600 mb-6",children:"Upload a photo to find similar products in nearby stores"}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"AI Image Analysis"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Smart Product Matching"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),"Location-Based Results"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-6 mb-8",children:[e.jsx(r,{className:"text-center",children:e.jsxs(t,{className:"pt-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx(S,{className:"h-6 w-6 text-blue-600"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"1. Upload Image"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Take a photo or upload an image of the product you're looking for"})]})}),e.jsx(r,{className:"text-center",children:e.jsxs(t,{className:"pt-6",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx(D,{className:"h-6 w-6 text-purple-600"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"2. AI Analysis"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Our AI identifies product type, colors, style, and key features"})]})}),e.jsx(r,{className:"text-center",children:e.jsxs(t,{className:"pt-6",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx(x,{className:"h-6 w-6 text-green-600"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"3. Find Nearby"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Search for stores near your location that might carry similar items"})]})}),e.jsx(r,{className:"text-center",children:e.jsxs(t,{className:"pt-6",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:e.jsx($,{className:"h-6 w-6 text-orange-600"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"4. Shop Local"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Get directions and visit local stores to find your perfect match"})]})})]}),e.jsx(ne,{}),e.jsxs("div",{className:"mt-12 grid md:grid-cols-2 gap-8",children:[e.jsxs(r,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-purple-600"}),"AI-Powered Recognition"]})}),e.jsx(t,{children:e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("li",{children:"â€¢ Advanced computer vision for accurate product identification"}),e.jsx("li",{children:"â€¢ Color, style, and brand recognition"}),e.jsx("li",{children:"â€¢ Category and subcategory classification"}),e.jsx("li",{children:"â€¢ Price range estimation"}),e.jsx("li",{children:"â€¢ Gender and age group targeting"})]})})]}),e.jsxs(r,{children:[e.jsx(l,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5 text-green-600"}),"Smart Location Matching"]})}),e.jsx(t,{children:e.jsxs("ul",{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("li",{children:"â€¢ GPS-based proximity search"}),e.jsx("li",{children:"â€¢ Category-relevant store filtering"}),e.jsx("li",{children:"â€¢ Real-time distance calculation"}),e.jsx("li",{children:"â€¢ Store verification and ratings"}),e.jsx("li",{children:"â€¢ One-click directions to stores"})]})})]})]}),e.jsxs(r,{className:"mt-8",children:[e.jsxs(l,{children:[e.jsx(n,{children:"Tips for Best Results"}),e.jsx(m,{children:"Get the most accurate matches with these photo tips"})]}),e.jsx(t,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Photo Quality"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Use good lighting"}),e.jsx("li",{children:"â€¢ Focus on the main product"}),e.jsx("li",{children:"â€¢ Avoid blurry images"}),e.jsx("li",{children:"â€¢ Include full product view"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Best Angles"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Front-facing view preferred"}),e.jsx("li",{children:"â€¢ Show distinctive features"}),e.jsx("li",{children:"â€¢ Include brand logos if visible"}),e.jsx("li",{children:"â€¢ Capture unique details"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"What Works Best"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Clothing and fashion items"}),e.jsx("li",{children:"â€¢ Electronics and gadgets"}),e.jsx("li",{children:"â€¢ Jewelry and accessories"}),e.jsx("li",{children:"â€¢ Home decor and furniture"})]})]})]})})]})]})})}export{ve as default};
