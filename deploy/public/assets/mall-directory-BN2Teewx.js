var W=Object.defineProperty;var J=(l,n,s)=>n in l?W(l,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[n]=s;var w=(l,n,s)=>J(l,typeof n!="symbol"?n+"":n,s);import{r as m,j as e,C as I,a as A,b as k,q as R,d as M,B as g,p as K,e as v,I as Z,S as G,L as b}from"./index-sTi6BLPu.js";import{u as O}from"./useQuery-4av79AcX.js";import{S as $,a as z,b as U,c as H,d as p}from"./select-U2_IWgob.js";import{H as X}from"./header-DCxgILpP.js";import{F as _}from"./footer-BkibQi5K.js";import{A as ee,a as te}from"./alert-BVbwNNU_.js";import{M as N}from"./map-pin-DZnENn3K.js";import{N as B}from"./navigation-C4cgsc30.js";import{C as se}from"./circle-check-ezVrciVg.js";import{S as ae}from"./search-BDvTlR0f.js";import{S as re}from"./store-fvM_Wsk5.js";import{U as ne}from"./users-n91sDYUr.js";import"./index-BdQq_4o_.js";import"./chevron-down-BDj7HIg7.js";import"./check-Cok4To_4.js";import"./authStore-CZi0z4It.js";import"./shopping-cart-DjSog6GS.js";import"./user-DzNM48-o.js";import"./house-CU825Ekn.js";import"./building-2-CmMn_uHF.js";import"./truck-CNzMFiRQ.js";import"./phone-BLNZn_t1.js";import"./shopping-bag-B6bbBeT-.js";import"./rocket-45aKcxBS.js";import"./shield-DYGAM3k4.js";import"./activity-_qjqvmcS.js";import"./credit-card-B1A0ZWNg.js";import"./globe-xPv-iFng.js";import"./eye-BfDIBTgL.js";import"./zap-1vep6Tn5.js";import"./wallet-CrGmaB25.js";const h=class h{constructor(){w(this,"currentLocation",null);w(this,"watchId",null)}static getInstance(){return h.instance||(h.instance=new h),h.instance}async getCurrentLocation(){return new Promise((n,s)=>{if(!navigator.geolocation){s(new Error("Geolocation is not supported by this browser"));return}navigator.geolocation.getCurrentPosition(async o=>{const r={latitude:o.coords.latitude,longitude:o.coords.longitude},i={coordinates:r,accuracy:o.coords.accuracy};try{const a=await this.reverseGeocode(r);i.address=a.address,i.city=a.city,i.state=a.state,i.zipCode=a.zipCode}catch(a){console.warn("Failed to reverse geocode:",a)}this.currentLocation=i,n(i)},o=>{s(new Error(`Geolocation error: ${o.message}`))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})})}watchLocation(n){if(!navigator.geolocation)throw new Error("Geolocation is not supported");return this.watchId=navigator.geolocation.watchPosition(async s=>{const o={latitude:s.coords.latitude,longitude:s.coords.longitude},r={coordinates:o,accuracy:s.coords.accuracy};try{const i=await this.reverseGeocode(o);r.address=i.address,r.city=i.city,r.state=i.state,r.zipCode=i.zipCode}catch(i){console.warn("Failed to reverse geocode:",i)}this.currentLocation=r,n(r)},s=>{console.error("Location watch error:",s)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:3e4}),this.watchId}stopWatching(){this.watchId!==null&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}calculateDistance(n,s){const r=this.toRad(s.latitude-n.latitude),i=this.toRad(s.longitude-n.longitude),a=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.toRad(n.latitude))*Math.cos(this.toRad(s.latitude))*Math.sin(i/2)*Math.sin(i/2),u=3959*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));return Math.round(u*100)/100}toRad(n){return n*Math.PI/180}async reverseGeocode(n){try{const s=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${n.latitude}&lon=${n.longitude}&zoom=18&addressdetails=1`);if(!s.ok)throw new Error("Geocoding request failed");const o=await s.json(),r=o.address||{};return{address:o.display_name||"Unknown address",city:r.city||r.town||r.village||"Unknown city",state:r.state||"Unknown state",zipCode:r.postcode||"Unknown ZIP"}}catch(s){throw console.error("Reverse geocoding error:",s),s}}async geocodeAddress(n){try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(n)}&limit=1`);if(!s.ok)throw new Error("Geocoding request failed");const o=await s.json();if(o.length===0)throw new Error("Address not found");return{latitude:parseFloat(o[0].lat),longitude:parseFloat(o[0].lon)}}catch(s){throw console.error("Forward geocoding error:",s),s}}calculateStoreDistances(n,s){return n.map(o=>{if(o.coordinates){const r=this.calculateDistance(s,o.coordinates);return{...o,distance:r,distanceText:`${r} mi`}}return o}).sort((o,r)=>(o.distance||1/0)-(r.distance||1/0))}getCachedLocation(){return this.currentLocation}async requestLocationPermission(){try{return(await navigator.permissions.query({name:"geolocation"})).state==="granted"}catch{try{return await this.getCurrentLocation(),!0}catch{return!1}}}};w(h,"instance");let D=h;const P=D.getInstance();function oe({onLocationGranted:l,onLocationDenied:n,showCard:s=!0}){const[o,r]=m.useState("unknown"),[i,a]=m.useState(null),[f,u]=m.useState(null);m.useEffect(()=>{y()},[]);const y=async()=>{try{if(await P.requestLocationPermission()){const j=P.getCachedLocation();j&&(a(j),r("granted"),l(j))}}catch(d){console.log("Permission check failed:",d)}},x=async()=>{r("requesting"),u(null);try{const d=await P.getCurrentLocation();a(d),r("granted"),l(d)}catch(d){console.error("Location request failed:",d),u(d instanceof Error?d.message:"Failed to get location"),r("denied"),n()}},C=()=>e.jsxs(e.Fragment,{children:[o==="unknown"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(N,{className:"h-12 w-12 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Find Stores Near You"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Allow location access to discover local stores and get accurate distances"})]}),e.jsxs(g,{onClick:x,className:"w-full",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Enable Location Services"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"We use your location only to show nearby stores and calculate distances"})]}),o==="requesting"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Getting Your Location"}),e.jsx("p",{className:"text-gray-600",children:"Please allow location access in your browser"})]})]}),o==="granted"&&i&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(se,{className:"h-8 w-8 text-green-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-green-700",children:"Location Enabled"}),e.jsx("p",{className:"text-sm text-gray-600",children:i.city&&i.state?`${i.city}, ${i.state}`:"Location detected"}),i.accuracy&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Accuracy: ",Math.round(i.accuracy),"m"]})]})]}),o==="denied"&&e.jsxs(ee,{className:"border-orange-200 bg-orange-50",children:[e.jsx(K,{className:"h-4 w-4 text-orange-600"}),e.jsx(te,{className:"text-orange-800",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Location access denied"})}),f&&e.jsx("p",{className:"text-sm",children:f}),e.jsx("p",{className:"text-sm",children:"You can still search stores manually by city or browse all locations. To enable location services later, click the location icon in your browser's address bar."}),e.jsx(g,{onClick:x,variant:"outline",size:"sm",className:"mt-2",children:"Try Again"})]})})]})]});return s?e.jsxs(I,{className:"w-full max-w-md mx-auto",children:[e.jsxs(A,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Location Services"]}),e.jsx(R,{children:"Get personalized store recommendations based on your location"})]}),e.jsx(M,{children:e.jsx(C,{})})]}):e.jsx(C,{})}const T=[{id:"downtown-plaza",name:"Downtown SPIRAL Plaza",location:"Downtown District",address:"123 Main Street, City Center",description:"The flagship SPIRAL mall featuring the best local artisans, boutiques, and eateries. Experience authentic local culture with exclusive SPIRAL rewards and community events.",image:"https://images.unsplash.com/photo-1555529669-2269763671c5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400",tenantCount:45,categories:["fashion","food","home","gifts","beauty"],spiralPerks:["Double SPIRALs on weekends","Exclusive member events","Priority pickup service"],rating:4.8,distance:.5,featured:!0},{id:"artisan-quarter",name:"Artisan Quarter Mall",location:"Historic Arts District",address:"456 Craft Lane, Arts Quarter",description:"A curated collection of local craftspeople and artisans. From handmade jewelry to custom furniture, discover unique pieces that tell the story of our community.",image:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400",tenantCount:28,categories:["crafts","art","home","gifts"],spiralPerks:["Artisan workshops included","Custom order discounts","Meet-the-maker events"],rating:4.9,distance:1.2,featured:!0},{id:"neighborhood-center",name:"Neighborhood SPIRAL Center",location:"Riverside Community",address:"789 Community Blvd, Riverside",description:"Your local community hub bringing together essential services, fresh groceries, and neighborhood favorites all in one convenient location.",image:"https://images.unsplash.com/photo-1543362906-acfc16c67564?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400",tenantCount:32,categories:["grocery","services","health","food"],spiralPerks:["Daily pickup convenience","Grocery loyalty bonuses","Community event hosting"],rating:4.6,distance:2.1,featured:!1},{id:"green-market",name:"Green Market SPIRAL Hub",location:"Sustainable District",address:"321 Eco Way, Green Quarter",description:"Focused on sustainable living and eco-friendly products. Support local businesses that care about our environment and community future.",image:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&h=400",tenantCount:22,categories:["sustainable","food","beauty","home"],spiralPerks:["Eco-bonus SPIRALs","Sustainability workshops","Carbon-neutral delivery"],rating:4.7,distance:3.5,featured:!1}];function ze(){const[l,n]=m.useState(""),[s,o]=m.useState("all"),[r,i]=m.useState("featured"),[a,f]=m.useState(null),[u,y]=m.useState(!0),{data:x,isLoading:C,error:d,refetch:j}=O({queryKey:["/api/mall-location-search",a,s],queryFn:async()=>{const t=new URLSearchParams;s!=="all"&&t.append("category",s),a!=null&&a.coordinates&&(t.append("latitude",a.coordinates.latitude.toString()),t.append("longitude",a.coordinates.longitude.toString()),t.append("radius","25")),a!=null&&a.city&&t.append("city",a.city),a!=null&&a.state&&t.append("state",a.state);const c=await fetch(`/api/mall-location-search?${t}`);if(!c.ok)throw new Error("Failed to search malls");return c.json()},enabled:!!a||s!=="all"}),Y=t=>{f(t),y(!1),j()},V=()=>{y(!1)},E=(x==null?void 0:x.malls)||[],L=E.length>0?E:T,q=L.filter(t=>{var F;const c=t.name.toLowerCase().includes(l.toLowerCase())||t.location.toLowerCase().includes(l.toLowerCase()),S=s==="all"||((F=t.categories)==null?void 0:F.includes(s));return c&&S}).sort((t,c)=>{switch(r){case"distance":return(t.distance||1/0)-(c.distance||1/0);case"rating":return(c.rating||0)-(t.rating||0);case"tenants":return(c.tenantCount||0)-(t.tenantCount||0);case"featured":return(c.featured?1:0)-(t.featured?1:0);default:return 0}}),Q=Array.from(new Set(L.flatMap(t=>t.categories||[])));return e.jsxs("div",{className:"min-h-screen bg-[var(--spiral-cream)]",children:[e.jsx(X,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-[var(--spiral-navy)] mb-4 font-['Poppins']",children:"SPIRAL Mall Directory"}),e.jsx("p",{className:"text-xl text-gray-600 mb-2 font-['Inter']",children:"Discover local shopping destinations in your community"}),e.jsx("p",{className:"text-[var(--spiral-coral)] font-semibold font-['Inter']",children:"Everything Local. Just for You."})]}),u&&!a&&e.jsx("div",{className:"mb-8",children:e.jsx(oe,{onLocationGranted:Y,onLocationDenied:V})}),a&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-8",children:e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Your Location:"}),e.jsx("span",{children:a.city&&a.state?`${a.city}, ${a.state}`:"Location detected"}),e.jsxs(v,{variant:"secondary",className:"ml-auto",children:[L.length," malls found nearby"]})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx(Z,{type:"text",placeholder:"Search malls or locations...",value:l,onChange:t=>n(t.target.value),className:"pl-10 rounded-xl"})]}),e.jsxs($,{value:s,onValueChange:o,children:[e.jsx(z,{className:"rounded-xl",children:e.jsx(U,{placeholder:"Filter by category"})}),e.jsxs(H,{children:[e.jsx(p,{value:"all",children:"All Categories"}),Q.map(t=>e.jsx(p,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]}),e.jsxs($,{value:r,onValueChange:i,children:[e.jsx(z,{className:"rounded-xl",children:e.jsx(U,{placeholder:"Sort by"})}),e.jsxs(H,{children:[e.jsx(p,{value:"featured",children:"Featured"}),e.jsx(p,{value:"distance",children:"Distance"}),e.jsx(p,{value:"rating",children:"Rating"}),e.jsx(p,{value:"tenants",children:"Number of Stores"})]})]})]})}),e.jsxs("div",{className:"mb-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-[var(--spiral-navy)] mb-6 font-['Poppins']",children:"Featured SPIRAL Destinations"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:T.filter(t=>t.featured).map(t=>e.jsxs(I,{className:"overflow-hidden shadow-lg border-0 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-48 object-cover"}),e.jsx(v,{className:"absolute top-4 left-4 bg-[var(--spiral-coral)] text-white",children:"Featured"})]}),e.jsx(A,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{className:"text-[var(--spiral-navy)] font-['Poppins']",children:t.name}),e.jsxs(R,{className:"font-['Inter'] flex items-center mt-2",children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),t.location," • ",t.distance," miles"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"text-sm font-semibold",children:t.rating})]})]})}),e.jsxs(M,{children:[e.jsx("p",{className:"text-gray-600 mb-4 font-['Inter']",children:t.description}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 font-['Inter']",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),t.tenantCount," Local Stores"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 font-['Inter']",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Community Hub"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.spiralPerks.slice(0,2).map((c,S)=>e.jsx(v,{variant:"outline",className:"text-xs border-[var(--spiral-sage)] text-[var(--spiral-sage)]",children:c},S))}),e.jsx(b,{href:`/mall/${t.id}`,children:e.jsx(g,{className:"w-full bg-[var(--spiral-navy)] hover:bg-[var(--spiral-coral)] text-white rounded-xl",children:"Explore Mall"})})]})]})]},t.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-[var(--spiral-navy)] mb-6 font-['Poppins']",children:["All SPIRAL Malls (",q.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(t=>e.jsxs(I,{className:"shadow-lg border-0 hover:shadow-xl transition-shadow",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-32 object-cover rounded-t-lg"}),t.featured&&e.jsx(v,{className:"absolute top-2 right-2 bg-[var(--spiral-gold)] text-white text-xs",children:"Featured"})]}),e.jsxs(A,{className:"pb-3",children:[e.jsx(k,{className:"text-lg text-[var(--spiral-navy)] font-['Poppins']",children:t.name}),e.jsx(R,{className:"font-['Inter'] text-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),t.distance?`${t.distance} mi`:t.location," • ",t.tenantCount," stores"]})})]}),e.jsxs(M,{className:"pt-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 text-yellow-400 fill-current mr-1"}),e.jsx("span",{className:"text-sm font-semibold",children:t.rating})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.categories.slice(0,2).map(c=>e.jsx(v,{variant:"secondary",className:"text-xs",children:c},c))})]}),e.jsx(b,{href:`/mall/${t.id}`,children:e.jsx(g,{variant:"outline",className:"w-full border-[var(--spiral-navy)] text-[var(--spiral-navy)] hover:bg-[var(--spiral-navy)] hover:text-white rounded-xl",children:"View Details"})})]})]},t.id))})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[var(--spiral-sage)]/20 to-[var(--spiral-coral)]/20 rounded-2xl p-8 text-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-[var(--spiral-navy)] mb-4 font-['Poppins']",children:"Ready to Explore Your Local Community?"}),e.jsx("p",{className:"text-gray-600 mb-6 font-['Inter']",children:"Visit any SPIRAL mall to earn rewards, support local businesses, and discover unique products you won't find anywhere else."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(b,{href:"/products",children:e.jsx(g,{className:"bg-[var(--spiral-navy)] hover:bg-[var(--spiral-coral)] text-white px-8 py-3 rounded-xl",children:"Browse Products"})}),e.jsx(b,{href:"/spirals",children:e.jsx(g,{variant:"outline",className:"border-[var(--spiral-coral)] text-[var(--spiral-coral)] hover:bg-[var(--spiral-coral)] hover:text-white px-8 py-3 rounded-xl",children:"Learn About SPIRALs"})})]})]})]}),e.jsx(_,{})]})}export{ze as default};
