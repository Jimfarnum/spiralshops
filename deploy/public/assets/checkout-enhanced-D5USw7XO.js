import{c as I,r as o,u as S,l as B,j as e,C as p,d as h,a as b,b as N,B as v,w as R,e as M}from"./index-sTi6BLPu.js";import{S as w}from"./separator-BcewAmr9.js";import{l as A,E,P as F,u as O,a as T}from"./index-D94guw86.js";import{A as Y}from"./arrow-left-DtuWXA6b.js";import{C as D}from"./credit-card-B1A0ZWNg.js";import{S as _}from"./smartphone-CbteIkmi.js";import"./index-D04l966U.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=I("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=I("Bitcoin",[["path",{d:"M11.767 19.089c4.924.868 6.14-6.025 1.216-6.894m-1.216 6.894L5.86 18.047m5.908 1.042-.347 1.97m1.563-8.864c4.924.869 6.14-6.025 1.215-6.893m-1.215 6.893-3.94-.694m5.155-6.2L8.29 4.26m5.908 1.042.348-1.97M7.48 20.364l3.126-17.727",key:"yr8idg"}]]),$=A("pk_test_51RovomEJ7kxSTVM4mZSvdUXJLoXYPvRBIZ7mKDBbXx3h0bzQMUmJOoihXtlTrKqHtrYbQmZQ9YPLVF5z39Sh4j8N00WlYRGOwL");function q({amount:n,orderId:c,onSuccess:u,onError:t}){const l=O(),i=T(),[d,a]=o.useState(!1),{toast:y}=S(),m=async j=>{if(j.preventDefault(),!l||!i)return;a(!0);const{error:x}=await l.confirmPayment({elements:i,confirmParams:{return_url:`${window.location.origin}/payment-success`},redirect:"if_required"});x?(y({title:"Payment Failed",description:x.message,variant:"destructive"}),t==null||t(x.message||"Payment failed")):(y({title:"Payment Successful",description:"Your payment has been processed successfully!"}),u==null||u("payment_succeeded")),a(!1)};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx(F,{}),e.jsx(v,{type:"submit",disabled:!l||d,className:"w-full",children:d?"Processing...":`Pay $${n.toFixed(2)}`})]})}function z({amount:n,orderId:c,title:u="Complete Payment",description:t,onSuccess:l,onError:i}){const[d,a]=o.useState(""),[y,m]=o.useState(!0),{toast:j}=S();if(o.useEffect(()=>{B("POST","/api/payment/create-payment-intent",{amount:n,orderId:c}).then(r=>r.json()).then(r=>{if(r.error)throw new Error(r.error);a(r.clientSecret)}).catch(r=>{console.error("Payment setup error:",r),j({title:"Payment Setup Failed",description:"Unable to initialize payment. Please try again.",variant:"destructive"}),i==null||i(r.message)}).finally(()=>{m(!1)})},[n,c,j,i]),y)return e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"}),e.jsx("span",{className:"ml-2",children:"Setting up payment..."})]})})});if(!d)return e.jsx(p,{children:e.jsx(h,{className:"p-6",children:e.jsx("div",{className:"text-center text-red-600",children:"Failed to setup payment. Please refresh and try again."})})});const g={clientSecret:d,appearance:{theme:"stripe",variables:{colorPrimary:"#006d77"}}};return e.jsxs(p,{children:[e.jsxs(b,{children:[e.jsx(N,{children:u}),t&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t})]}),e.jsx(h,{children:e.jsx(E,{stripe:$,options:g,children:e.jsx(q,{amount:n,orderId:c,onSuccess:l,onError:i})})})]})}function J({amount:n,orderId:c,onSuccess:u,onError:t}){const[l,i]=o.useState("");if(o.useEffect(()=>{B("POST","/api/payment/create-payment-intent",{amount:n,orderId:c}).then(a=>a.json()).then(a=>{i(a.clientSecret)}).catch(a=>{console.error("Express checkout setup error:",a),t==null||t(a.message)})},[n,c,t]),!l)return null;const d={clientSecret:l,appearance:{theme:"stripe"}};return e.jsx(E,{stripe:$,options:d,children:e.jsx("div",{className:"mb-4",children:e.jsx(F,{options:{layout:{type:"tabs",defaultCollapsed:!1}}})})})}function H(){const[,n]=R(),[c,u]=o.useState([]),[t,l]=o.useState("stripe"),[i,d]=o.useState(!1),{toast:a}=S(),y=[{id:"stripe",name:"Credit/Debit Card",icon:e.jsx(D,{className:"w-5 h-5"}),description:"Visa, Mastercard, American Express",available:!0},{id:"express",name:"Express Checkout",icon:e.jsx(_,{className:"w-5 h-5"}),description:"Apple Pay, Google Pay",available:!0},{id:"bnpl",name:"Buy Now, Pay Later",icon:e.jsx(k,{className:"w-5 h-5"}),description:"Klarna, Afterpay (Coming Soon)",available:!1},{id:"crypto",name:"Cryptocurrency",icon:e.jsx(L,{className:"w-5 h-5"}),description:"Bitcoin, Ethereum (Coming Soon)",available:!1}];o.useEffect(()=>{const s=localStorage.getItem("cart");if(s)try{u(JSON.parse(s))}catch(f){console.error("Error loading cart:",f)}},[]);const m=c.reduce((s,f)=>s+f.price*f.quantity,0),j=m*.08,x=m>50?0:9.99,g=Math.floor(m/100)*5,r=m+j+x,P=s=>{d(!0),setTimeout(()=>{localStorage.removeItem("cart");const f=parseInt(localStorage.getItem("spiralBalance")||"0");localStorage.setItem("spiralBalance",(f+g).toString()),a({title:"Payment Successful!",description:`Order confirmed! You earned ${g} SPIRAL points.`}),n("/payment-success")},2e3)},C=s=>{a({title:"Payment Failed",description:s,variant:"destructive"}),d(!1)};return c.length===0?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(p,{children:e.jsxs(h,{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add some items to your cart to proceed with checkout."}),e.jsx(v,{onClick:()=>n("/"),children:"Continue Shopping"})]})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>n("/cart"),className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Back to Cart"]}),e.jsx("h1",{className:"text-3xl font-bold",children:"Enhanced Checkout"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(b,{children:e.jsx(N,{children:"Payment Method"})}),e.jsx(h,{className:"space-y-4",children:y.map(s=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${t===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"} ${s.available?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>s.available&&l(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.icon,e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.description})]})]}),!s.available&&e.jsx(M,{variant:"secondary",children:"Coming Soon"})]})},s.id))})]}),t==="stripe"&&e.jsx(z,{amount:r,orderId:`ORDER_${Date.now()}`,title:"Complete Your Payment",description:"Secure payment processing with Stripe",onSuccess:P,onError:C}),t==="express"&&e.jsxs(p,{children:[e.jsx(b,{children:e.jsx(N,{children:"Express Checkout"})}),e.jsx(h,{children:e.jsx(J,{amount:r,orderId:`ORDER_${Date.now()}`,onSuccess:P,onError:C})})]}),(t==="bnpl"||t==="crypto")&&e.jsx(p,{children:e.jsxs(h,{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:t==="bnpl"?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Buy Now, Pay Later"}),e.jsx("p",{children:"Klarna and Afterpay integration coming soon!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-12 h-12 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Cryptocurrency Payments"}),e.jsx("p",{children:"Bitcoin and Ethereum payments coming soon!"})]})}),e.jsx(v,{variant:"outline",onClick:()=>l("stripe"),children:"Use Credit Card Instead"})]})})]}),e.jsx("div",{children:e.jsxs(p,{className:"sticky top-4",children:[e.jsx(b,{children:e.jsx(N,{children:"Order Summary"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-sm text-gray-600",children:s.storeName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-medium",children:["$",(s.price*s.quantity).toFixed(2)]})})]},s.id))}),e.jsx(w,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:["$",j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:x===0?"FREE":`$${x.toFixed(2)}`})]}),x===0&&e.jsx("div",{className:"text-sm text-green-600",children:"Free shipping on orders over $50!"})]}),e.jsx(w,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",r.toFixed(2)]})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"SPIRAL Points"}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:["+",g," SPIRALs"]})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Earn 5 SPIRALs for every $100 spent online"})]}),e.jsx("div",{className:"text-center pt-4",children:e.jsx("div",{className:"text-xs text-gray-500",children:"ðŸ”’ Secured by Stripe â€¢ SSL Encrypted"})})]})]})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx(p,{children:e.jsxs(h,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Processing Payment"}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we process your order..."})]})})})]})}export{H as default};
