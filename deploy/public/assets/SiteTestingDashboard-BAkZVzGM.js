import{r as l,j as s,C as i,a as N,b as v,d as c,B as h,q as D,f as w,s as F,e as p}from"./index-sTi6BLPu.js";import{P as B}from"./progress-Cf362TSq.js";import{A as q,a as U}from"./alert-BVbwNNU_.js";import{E as y}from"./eye-BfDIBTgL.js";import{P as T}from"./play-iEIZvRqg.js";import{S as $}from"./square-C0TPHeSi.js";import{T as O}from"./triangle-alert-CgctdoVb.js";import{C as J}from"./circle-x-WVieisiF.js";function V(){var f;const[t,b]=l.useState(null),[r,C]=l.useState([]),[u,d]=l.useState(!1),[R,S]=l.useState(new Date);l.useEffect(()=>{let e;return t!=null&&t.isRunning&&(e=setInterval(()=>{o(),x()},2e3)),()=>{e&&clearInterval(e)}},[t==null?void 0:t.isRunning]);const o=async()=>{try{const a=await(await fetch("/api/site-testing/status")).json();a.success&&(b(a.status),S(new Date))}catch(e){console.error("Failed to fetch test status:",e)}},x=async()=>{try{const a=await(await fetch("/api/site-testing/results")).json();a.success&&C(a.results)}catch(e){console.error("Failed to fetch test results:",e)}},I=async()=>{d(!0);try{const a=await(await fetch("/api/site-testing/start",{method:"POST",headers:{"Content-Type":"application/json"}})).json();a.success?(await o(),await x()):console.error("Failed to start testing:",a.message)}catch(e){console.error("Error starting tests:",e)}finally{d(!1)}},P=async()=>{try{(await(await fetch("/api/site-testing/stop",{method:"POST",headers:{"Content-Type":"application/json"}})).json()).success&&await o()}catch(e){console.error("Error stopping tests:",e)}},k=async e=>{d(!0);try{(await(await fetch(`/api/site-testing/quick-test/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json()).success&&await x()}catch(a){console.error("Error running quick test:",a)}finally{d(!1)}};l.useEffect(()=>{o(),x()},[]);const A=e=>{switch(e){case"success":return s.jsx(F,{className:"h-4 w-4 text-green-500"});case"failed":return s.jsx(J,{className:"h-4 w-4 text-red-500"});case"running":return s.jsx(w,{className:"h-4 w-4 text-blue-500 animate-spin"});default:return s.jsx(w,{className:"h-4 w-4 text-gray-400"})}},g=e=>e<1e3?`${e}ms`:`${(e/1e3).toFixed(1)}s`,j=e=>e<1e3?s.jsx(p,{variant:"default",className:"bg-green-100 text-green-800",children:"Fast"}):e<3e3?s.jsx(p,{variant:"secondary",children:"Normal"}):s.jsx(p,{variant:"destructive",children:"Slow"}),E=r.reduce((e,a)=>e+a.issues.length,0),_=r.reduce((e,a)=>e+a.steps.length,0),L=r.reduce((e,a)=>e+a.steps.filter(n=>n.status==="failed").length,0);return s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"SPIRAL Site Testing AI Agent"}),s.jsx("p",{className:"text-gray-600",children:"Watch the AI test your entire platform as a real user"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{className:"h-5 w-5 text-blue-500"}),s.jsxs("span",{className:"text-sm text-gray-500",children:["Last update: ",R.toLocaleTimeString()]})]})]}),s.jsxs(i,{children:[s.jsx(N,{children:s.jsxs(v,{className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-5 w-5"}),"Testing Controls"]})}),s.jsxs(c,{className:"space-y-4",children:[s.jsxs("div",{className:"flex gap-4",children:[s.jsxs(h,{onClick:I,disabled:u||(t==null?void 0:t.isRunning),className:"flex items-center gap-2",children:[s.jsx(T,{className:"h-4 w-4"}),"Start Complete Testing"]}),(t==null?void 0:t.isRunning)&&s.jsxs(h,{onClick:P,variant:"destructive",className:"flex items-center gap-2",children:[s.jsx($,{className:"h-4 w-4"}),"Stop Testing"]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium mb-2",children:"Quick Tests:"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["homepage_visitor","product_browser","store_explorer","shopper_signup","retailer_signup"].map(e=>s.jsx(h,{onClick:()=>k(e),disabled:u||(t==null?void 0:t.isRunning),variant:"outline",size:"sm",children:e.replace("_"," ").toUpperCase()},e))})]})]})]}),t&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(i,{children:s.jsx(c,{className:"p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Status"}),s.jsx("p",{className:"text-2xl font-bold",children:t.isRunning?"Running":"Idle"})]}),s.jsx("div",{className:`h-3 w-3 rounded-full ${t.isRunning?"bg-green-500 animate-pulse":"bg-gray-300"}`})]})})}),s.jsx(i,{children:s.jsx(c,{className:"p-4",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Current Test"}),s.jsx("p",{className:"text-2xl font-bold",children:((f=t.currentTest)==null?void 0:f.replace("_"," "))||"None"})]})})}),s.jsx(i,{children:s.jsx(c,{className:"p-4",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Progress"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(B,{value:t.completedTests/t.totalJourneys*100,className:"flex-1"}),s.jsxs("span",{className:"text-sm",children:[t.completedTests,"/",t.totalJourneys]})]})]})})}),s.jsx(i,{children:s.jsx(c,{className:"p-4",children:s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium",children:"Issues Found"}),s.jsx("p",{className:"text-2xl font-bold text-red-500",children:E})]})})})]}),r.length>0&&s.jsxs(i,{children:[s.jsxs(N,{children:[s.jsxs(v,{children:["Test Results (",r.length," journeys completed)"]}),s.jsxs(D,{children:[_," total steps, ",L," failed"]})]}),s.jsx(c,{children:s.jsx("div",{className:"space-y-4",children:r.map((e,a)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h3",{className:"font-semibold text-lg",children:e.journey.replace("_"," ").toUpperCase()}),s.jsxs("div",{className:"flex items-center gap-2",children:[e.duration&&j(e.duration),s.jsx("span",{className:"text-sm text-gray-500",children:e.duration?g(e.duration):"Running..."})]})]}),s.jsx("div",{className:"space-y-2 mb-3",children:e.steps.map((n,m)=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[A(n.status),s.jsx("span",{className:"text-sm",children:n.name})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[j(n.duration),s.jsx("span",{className:"text-xs text-gray-500",children:g(n.duration)})]})]},m))}),e.issues.length>0&&s.jsxs(q,{children:[s.jsx(O,{className:"h-4 w-4"}),s.jsxs(U,{children:[s.jsxs("strong",{children:[e.issues.length," issues found:"]}),s.jsx("ul",{className:"mt-1 list-disc list-inside space-y-1",children:e.issues.map((n,m)=>s.jsxs("li",{className:"text-sm",children:[n.step&&s.jsxs("strong",{children:[n.step,":"]})," ",n.message]},m))})]})]})]},a))})})]}),r.length===0&&!(t!=null&&t.isRunning)&&s.jsx(i,{children:s.jsx(c,{className:"p-8 text-center",children:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx(y,{className:"h-12 w-12 text-gray-400"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-lg",children:"No tests run yet"}),s.jsx("p",{className:"text-gray-600",children:'Click "Start Complete Testing" to watch the AI navigate through your entire SPIRAL platform'})]})]})})})]})}export{V as default};
