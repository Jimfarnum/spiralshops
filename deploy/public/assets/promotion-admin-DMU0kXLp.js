import{r as c,u as K,j as e,B as n,C as d,d as o,Q as $,F as B,J as O,K as w,M as k,a as g,b as v,s as z,e as N,I as y}from"./index-sTi6BLPu.js";import{T as G}from"./textarea-DwFaTdzp.js";import{U}from"./users-n91sDYUr.js";import{T as Y}from"./trending-up-CRcGIWQN.js";import{T as H}from"./triangle-alert-CgctdoVb.js";import{C as J}from"./circle-x-WVieisiF.js";var h={};function Q(){const[R,C]=c.useState([]),[A,E]=c.useState([]),[r,D]=c.useState(null),[P,f]=c.useState(!0),[i,u]=c.useState(null),[l,j]=c.useState({code:"",overrideMultiplier:"",overrideStartsAt:"",overrideEndsAt:"",adminNotes:""}),[T,I]=c.useState(""),{toast:a}=K();c.useEffect(()=>{m()},[]);const m=async()=>{try{f(!0);const s=localStorage.getItem("spiral_admin_key")||h.VITE_ADMIN_KEY;if(!s){a({title:"Admin Access Required",description:"Please set your admin key in localStorage as spiral_admin_key",variant:"destructive"});return}const t={"x-admin-key":s},[x,b,S]=await Promise.all([fetch("/api/admin/promotions/requests",{headers:t}),fetch("/api/admin/promotions/promotions",{headers:t}),fetch("/api/admin/promotions/analytics",{headers:t})]);if(x.ok){const p=await x.json();C(p.requests||[])}if(b.ok){const p=await b.json();E(p.promotions||[])}if(S.ok){const p=await S.json();D(p.analytics)}}catch(s){console.error("Error loading data:",s),a({title:"Error",description:"Failed to load promotion data",variant:"destructive"})}finally{f(!1)}},M=async s=>{try{const t=localStorage.getItem("spiral_admin_key")||h.VITE_ADMIN_KEY;if((await fetch(`/api/admin/promotions/requests/${s}/revalue`,{method:"POST",headers:{"x-admin-key":t||""}})).ok)a({title:"Success",description:"Request revalued successfully"}),m();else throw new Error("Failed to revalue request")}catch{a({title:"Error",description:"Failed to revalue request",variant:"destructive"})}},_=async()=>{if(!i||!l.code){a({title:"Error",description:"Please fill in the promotion code",variant:"destructive"});return}try{const s=localStorage.getItem("spiral_admin_key")||h.VITE_ADMIN_KEY;if((await fetch(`/api/admin/promotions/requests/${i.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":s||""},body:JSON.stringify(l)})).ok)a({title:"Success",description:"Request approved and promotion created"}),u(null),j({code:"",overrideMultiplier:"",overrideStartsAt:"",overrideEndsAt:"",adminNotes:""}),m();else throw new Error("Failed to approve request")}catch{a({title:"Error",description:"Failed to approve request",variant:"destructive"})}},q=async s=>{try{const t=localStorage.getItem("spiral_admin_key")||h.VITE_ADMIN_KEY;if((await fetch(`/api/admin/promotions/requests/${s}/reject`,{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":t||""},body:JSON.stringify({reason:T})})).ok)a({title:"Success",description:"Request rejected"}),I(""),m();else throw new Error("Failed to reject request")}catch{a({title:"Error",description:"Failed to reject request",variant:"destructive"})}},L=async s=>{try{const t=localStorage.getItem("spiral_admin_key")||h.VITE_ADMIN_KEY;if((await fetch(`/api/admin/promotions/promotions/${s}/toggle`,{method:"POST",headers:{"x-admin-key":t||""}})).ok)a({title:"Success",description:"Promotion status updated"}),m();else throw new Error("Failed to toggle promotion")}catch{a({title:"Error",description:"Failed to update promotion status",variant:"destructive"})}},V=s=>{const t={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-red-100 text-red-800"};return e.jsx(N,{className:t[s]||t.medium,children:s.toUpperCase()})},F=s=>{const t={pending:"bg-blue-100 text-blue-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return e.jsx(N,{className:t[s]||t.pending,children:s})};return P?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading promotion dashboard..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"SPIRALS Promotion Management"}),e.jsx(n,{onClick:m,variant:"outline",children:"Refresh Data"})]}),r&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Requests"}),e.jsx("p",{className:"text-2xl font-bold",children:r.requests.total}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.requests.pending," pending"]})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Promotions"}),e.jsx("p",{className:"text-2xl font-bold",children:r.promotions.active}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.promotions.averageMultiplier.toFixed(1),"x avg multiplier"]})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Projected GMV"}),e.jsxs("p",{className:"text-2xl font-bold",children:["$",(r.promotions.totalProjectedGMV/1e6).toFixed(1),"M"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total pipeline"})]})]})})}),e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-8 w-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Risk Distribution"}),e.jsxs("div",{className:"flex space-x-1 text-sm",children:[e.jsxs("span",{className:"text-green-600",children:[r.risk.low,"L"]}),e.jsxs("span",{className:"text-yellow-600",children:[r.risk.medium,"M"]}),e.jsxs("span",{className:"text-red-600",children:[r.risk.high,"H"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Low/Med/High risk"})]})]})})})]}),e.jsxs(B,{defaultValue:"requests",className:"space-y-4",children:[e.jsxs(O,{children:[e.jsx(w,{value:"requests",children:"Promotion Requests"}),e.jsx(w,{value:"promotions",children:"Active Promotions"})]}),e.jsx(k,{value:"requests",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(v,{children:"Partner Promotion Requests"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:R.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.requesterName}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.contactEmail," • ",s.requesterType]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[F(s.status),V(s.valuationRisk)]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Desired Multiplier"}),e.jsxs("p",{className:"font-semibold",children:[s.desiredMultiplier,"x"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Expected GMV"}),e.jsxs("p",{className:"font-semibold",children:["$",Number(s.expectedGMV).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Sponsor Coverage"}),e.jsxs("p",{className:"font-semibold",children:[s.sponsorCoveragePct,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Valuation Score"}),e.jsxs("p",{className:"font-semibold",children:[s.valuationScore,"/100"]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-gray-600",children:"Duration"}),e.jsxs("p",{children:[new Date(s.desiredStartsAt).toLocaleDateString()," - ",new Date(s.desiredEndsAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-gray-600",children:"AI Analysis"}),e.jsx("p",{className:"text-xs bg-gray-50 p-2 rounded",children:s.valuationNotes})]}),s.status==="pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(n,{size:"sm",onClick:()=>u(s),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(n,{size:"sm",variant:"destructive",onClick:()=>q(s.id),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Reject"]}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>M(s.id),children:"Re-evaluate"})]})]},s.id))})})]})}),e.jsx(k,{value:"promotions",className:"space-y-4",children:e.jsxs(d,{children:[e.jsx(g,{children:e.jsx(v,{children:"Active Promotions"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Code: ",s.code]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{className:s.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:s.active?"ACTIVE":"INACTIVE"}),e.jsx(n,{size:"sm",variant:"outline",onClick:()=>L(s.code),children:s.active?"Deactivate":"Activate"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Multiplier"}),e.jsxs("p",{className:"font-semibold",children:[s.multiplier,"x"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Partners"}),e.jsxs("p",{className:"font-semibold",children:[s.partners.length," partners"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Categories"}),e.jsxs("p",{className:"font-semibold",children:[s.categories.length," categories"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Duration"}),e.jsxs("p",{className:"font-semibold",children:[new Date(s.startsAt).toLocaleDateString()," - ",new Date(s.endsAt).toLocaleDateString()]})]})]}),s.projectedImpact&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded text-sm",children:[e.jsx("p",{className:"font-semibold text-blue-800 mb-1",children:"Projected Impact (per $100K GMV)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Customer Rewards"}),e.jsxs("p",{className:"font-semibold",children:["$",s.projectedImpact.customerBenefit.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Platform Cost"}),e.jsxs("p",{className:"font-semibold",children:["$",s.projectedImpact.platformCost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Total Rewards"}),e.jsxs("p",{className:"font-semibold",children:["$",s.projectedImpact.estimatedRewards.toLocaleString()]})]})]})]})]},s.id))})})]})})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(d,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(g,{children:e.jsx(v,{children:"Approve Promotion Request"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Requester: ",i.requesterName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Score: ",i.valuationScore,"/100 • Risk: ",i.valuationRisk]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Promotion Code *"}),e.jsx(y,{value:l.code,onChange:s=>j({...l,code:s.target.value}),placeholder:"e.g., SUMMER2025"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Override Multiplier (optional)"}),e.jsx(y,{type:"number",min:"2",max:"10",step:"0.1",value:l.overrideMultiplier,onChange:s=>j({...l,overrideMultiplier:s.target.value}),placeholder:`Recommended: ${i.recommendedMultiplier}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Recommended Duration"}),e.jsx(y,{value:`${i.recommendedDurationDays} days`,disabled:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Admin Notes"}),e.jsx(G,{value:l.adminNotes,onChange:s=>j({...l,adminNotes:s.target.value}),placeholder:"Internal notes about this approval...",rows:3})]})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsx(n,{onClick:_,className:"bg-green-600 hover:bg-green-700",children:"Approve & Create Promotion"}),e.jsx(n,{variant:"outline",onClick:()=>u(null),children:"Cancel"})]})]})]})})]})}function ae(){return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(Q,{})})}export{ae as default};
