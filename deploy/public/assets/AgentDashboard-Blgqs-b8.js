import{r as l,j as e,B as N,C as n,d as i,f as o,s as v,I as M,a as O,b as k,q as V,D as z,v as H,g as $,h as q,i as U,e as f}from"./index-sTi6BLPu.js";import{S as b,a as y,b as A,c as S,d as a}from"./select-U2_IWgob.js";import{A as w}from"./AdminLayout-Bg0V37d0.js";import{R as X}from"./refresh-cw-bGZJGN_p.js";import{B as C}from"./bot-oWb1Anye.js";import{C as D}from"./circle-x-WVieisiF.js";import{E as Z}from"./eye-BfDIBTgL.js";import{T as G}from"./triangle-alert-CgctdoVb.js";import"./index-BdQq_4o_.js";import"./chevron-down-BDj7HIg7.js";import"./check-Cok4To_4.js";import"./shield-DYGAM3k4.js";import"./house-CU825Ekn.js";import"./users-n91sDYUr.js";import"./chart-column-DFfP8Ytq.js";function xe(){const[r,L]=l.useState([]),[I,E]=l.useState(!0),[d,R]=l.useState(""),[h,T]=l.useState("all"),[m,B]=l.useState("all"),[J,F]=l.useState(null);l.useEffect(()=>{j();const s=setInterval(j,3e4);return()=>clearInterval(s)},[]);const j=async()=>{try{const t=await(await fetch("/api/admin/agent-logs")).json();t.success&&L(t.data)}catch(s){console.error("Failed to fetch agent logs:",s)}finally{E(!1)}},u=s=>{const t={active:"bg-blue-100 text-blue-800",complete:"bg-green-100 text-green-800",error:"bg-red-100 text-red-800",abandoned:"bg-gray-100 text-gray-800"},p={active:o,complete:v,error:D,abandoned:G}[s];return e.jsxs(f,{className:t[s],children:[e.jsx(p,{className:"w-3 h-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},P=s=>{const t={RetailerOnboardAgent:"bg-purple-100 text-purple-800",ProductEntryAgent:"bg-teal-100 text-teal-800",ShopperAssistAgent:"bg-orange-100 text-orange-800",AdminAuditAgent:"bg-red-100 text-red-800"};return e.jsxs(f,{className:t[s],children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),s.replace("Agent","")]})},g=r.filter(s=>{const t=s.retailerName.toLowerCase().includes(d.toLowerCase())||s.agentName.toLowerCase().includes(d.toLowerCase())||s.retailerId.toLowerCase().includes(d.toLowerCase()),x=h==="all"||s.agentName===h,p=m==="all"||s.status===m;return t&&x&&p}),c={total:r.length,active:r.filter(s=>s.status==="active").length,complete:r.filter(s=>s.status==="complete").length,errors:r.filter(s=>s.status==="error").length,avgDuration:r.length>0?Math.round(r.reduce((s,t)=>s+t.sessionDuration,0)/r.length):0};return I?e.jsx(w,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})}):e.jsx(w,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-teal-600",children:"Agent Activity Monitor"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor all SPIRAL AI agent interactions and performance"})]}),e.jsxs(N,{onClick:j,variant:"outline",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-4",children:[e.jsx(n,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sessions"}),e.jsx("p",{className:"text-2xl font-bold",children:c.total})]}),e.jsx(C,{className:"w-8 h-8 text-teal-500"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.active})]}),e.jsx(o,{className:"w-8 h-8 text-blue-500"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.complete})]}),e.jsx(v,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Errors"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.errors})]}),e.jsx(D,{className:"w-8 h-8 text-red-500"})]})})}),e.jsx(n,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Duration"}),e.jsxs("p",{className:"text-2xl font-bold",children:[c.avgDuration,"m"]})]}),e.jsx(o,{className:"w-8 h-8 text-purple-500"})]})})})]}),e.jsx(n,{children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(M,{placeholder:"Search by retailer, agent, or session ID...",value:d,onChange:s=>R(s.target.value)}),e.jsxs(b,{value:h,onValueChange:T,children:[e.jsx(y,{children:e.jsx(A,{placeholder:"Filter by agent"})}),e.jsxs(S,{children:[e.jsx(a,{value:"all",children:"All Agents"}),e.jsx(a,{value:"RetailerOnboardAgent",children:"Retailer Onboard"}),e.jsx(a,{value:"ProductEntryAgent",children:"Product Entry"}),e.jsx(a,{value:"ShopperAssistAgent",children:"Shopper Assist"}),e.jsx(a,{value:"AdminAuditAgent",children:"Admin Audit"})]})]}),e.jsxs(b,{value:m,onValueChange:B,children:[e.jsx(y,{children:e.jsx(A,{placeholder:"Filter by status"})}),e.jsxs(S,{children:[e.jsx(a,{value:"all",children:"All Statuses"}),e.jsx(a,{value:"active",children:"Active"}),e.jsx(a,{value:"complete",children:"Complete"}),e.jsx(a,{value:"error",children:"Error"}),e.jsx(a,{value:"abandoned",children:"Abandoned"})]})]})]})})}),e.jsxs(n,{children:[e.jsxs(O,{children:[e.jsxs(k,{children:["Agent Sessions (",g.length,")"]}),e.jsx(V,{children:"Real-time monitoring of all AI agent interactions"})]}),e.jsx(i,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Agent"}),e.jsx("th",{className:"text-left p-3",children:"Retailer"}),e.jsx("th",{className:"text-left p-3",children:"Status"}),e.jsx("th",{className:"text-left p-3",children:"Progress"}),e.jsx("th",{className:"text-left p-3",children:"Duration"}),e.jsx("th",{className:"text-left p-3",children:"Last Activity"}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:P(s.agentName)}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.retailerName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.retailerId})]})}),e.jsx("td",{className:"p-3",children:u(s.status)}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step ",s.currentStep," of ",s.totalSteps]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-teal-500 h-2 rounded-full",style:{width:`${s.currentStep/s.totalSteps*100}%`}})}),e.jsx("div",{className:"text-xs text-gray-500",children:s.stepCompleted})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4 text-gray-400"}),s.sessionDuration,"m"]})}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.lastActivity).toLocaleString()})}),e.jsx("td",{className:"p-3",children:e.jsxs(z,{children:[e.jsx(H,{asChild:!0,children:e.jsx(N,{size:"sm",variant:"outline",onClick:()=>F(s),children:e.jsx(Z,{className:"w-4 h-4"})})}),e.jsxs($,{className:"max-w-2xl",children:[e.jsx(q,{children:e.jsxs(U,{children:["Session Details - ",s.agentName]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Session Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Agent:"})," ",s.agentName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Retailer:"})," ",s.retailerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Session ID:"})," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Started:"})," ",new Date(s.timestamp).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",s.sessionDuration," minutes"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Progress & Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),u(s.status)]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Progress:"}),e.jsxs("span",{children:[s.currentStep,"/",s.totalSteps," steps"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Step:"}),e.jsx("span",{className:"text-sm",children:s.stepCompleted})]})]})]})]}),s.metadata&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Session Metadata"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded text-sm space-y-1",children:Object.entries(s.metadata).map(([t,x])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"capitalize",children:[t.replace(/([A-Z])/g," $1"),":"]}),e.jsx("span",{children:String(x)})]},t))})]}),s.errorMessage&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2 text-red-600",children:"Error Details"}),e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded text-sm text-red-800",children:s.errorMessage})]}),s.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Notes"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded text-sm",children:s.notes})]})]})]})]})})]},s.id))})]})})})]})]})})}export{xe as default};
