import{al as H,r as p,aq as J,j as e,ay as D,as as _,ap as he,aQ as fe,aV as je,an as Z,aF as ge,aJ as ve,aw as ye,az as Ne,a8 as W,a9 as be,aa as we,u as Ce,U as Se,C as b,d as w,P as A,L as Re,B as k,a as C,b as S,e as O,S as B,f as ke}from"./index-sTi6BLPu.js";import{S as Ie}from"./separator-BcewAmr9.js";import{C as Pe,T as Q}from"./truck-CNzMFiRQ.js";import{L}from"./label-DXgakF6_.js";import{u as U}from"./useQuery-4av79AcX.js";import{u as Ee}from"./useMutation-DaiJly-X.js";import{Z as $}from"./zap-1vep6Tn5.js";import{S as Fe}from"./sparkles-BuZ9UEHA.js";import{C as G}from"./credit-card-B1A0ZWNg.js";import{M as q}from"./map-pin-DZnENn3K.js";import{S as Y}from"./shield-DYGAM3k4.js";import{C as I}from"./check-Cok4To_4.js";var M="Radio",[Ae,X]=H(M),[Oe,Le]=Ae(M),ee=p.forwardRef((i,o)=>{const{__scopeRadio:a,name:n,checked:t=!1,required:r,disabled:d,value:c="on",onCheck:u,form:j,...h}=i,[m,g]=p.useState(null),l=J(o,N=>g(N)),v=p.useRef(!1),y=m?j||!!m.closest("form"):!0;return e.jsxs(Oe,{scope:a,checked:t,disabled:d,children:[e.jsx(D.button,{type:"button",role:"radio","aria-checked":t,"data-state":te(t),"data-disabled":d?"":void 0,disabled:d,value:c,...h,ref:l,onClick:_(i.onClick,N=>{t||u==null||u(),y&&(v.current=N.isPropagationStopped(),v.current||N.stopPropagation())})}),y&&e.jsx($e,{control:m,bubbles:!v.current,name:n,value:c,checked:t,required:r,disabled:d,form:j,style:{transform:"translateX(-100%)"}})]})});ee.displayName=M;var se="RadioIndicator",ae=p.forwardRef((i,o)=>{const{__scopeRadio:a,forceMount:n,...t}=i,r=Le(se,a);return e.jsx(he,{present:n||r.checked,children:e.jsx(D.span,{"data-state":te(r.checked),"data-disabled":r.disabled?"":void 0,...t,ref:o})})});ae.displayName=se;var $e=i=>{const{control:o,checked:a,bubbles:n=!0,...t}=i,r=p.useRef(null),d=fe(a),c=je(o);return p.useEffect(()=>{const u=r.current,j=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(j,"checked").set;if(d!==a&&m){const g=new Event("click",{bubbles:n});m.call(u,a),u.dispatchEvent(g)}},[d,a,n]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:a,...t,tabIndex:-1,ref:r,style:{...i.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function te(i){return i?"checked":"unchecked"}var Ge=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],T="RadioGroup",[qe,ss]=H(T,[Z,X]),re=Z(),ie=X(),[_e,De]=qe(T),ne=p.forwardRef((i,o)=>{const{__scopeRadioGroup:a,name:n,defaultValue:t,value:r,required:d=!1,disabled:c=!1,orientation:u,dir:j,loop:h=!0,onValueChange:m,...g}=i,l=re(a),v=ge(j),[y,N]=ve({prop:r,defaultProp:t,onChange:m});return e.jsx(_e,{scope:a,name:n,required:d,disabled:c,value:y,onValueChange:N,children:e.jsx(ye,{asChild:!0,...l,orientation:u,dir:v,loop:h,children:e.jsx(D.div,{role:"radiogroup","aria-required":d,"aria-orientation":u,"data-disabled":c?"":void 0,dir:v,...g,ref:o})})})});ne.displayName=T;var ce="RadioGroupItem",oe=p.forwardRef((i,o)=>{const{__scopeRadioGroup:a,disabled:n,...t}=i,r=De(ce,a),d=r.disabled||n,c=re(a),u=ie(a),j=p.useRef(null),h=J(o,j),m=r.value===t.value,g=p.useRef(!1);return p.useEffect(()=>{const l=y=>{Ge.includes(y.key)&&(g.current=!0)},v=()=>g.current=!1;return document.addEventListener("keydown",l),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",l),document.removeEventListener("keyup",v)}},[]),e.jsx(Ne,{asChild:!0,...c,focusable:!d,active:m,children:e.jsx(ee,{disabled:d,required:r.required,checked:m,...u,...t,name:r.name,ref:h,onCheck:()=>r.onValueChange(t.value),onKeyDown:_(l=>{l.key==="Enter"&&l.preventDefault()}),onFocus:_(t.onFocus,()=>{var l;g.current&&((l=j.current)==null||l.click())})})})});oe.displayName=ce;var Me="RadioGroupIndicator",de=p.forwardRef((i,o)=>{const{__scopeRadioGroup:a,...n}=i,t=ie(a);return e.jsx(ae,{...t,...n,ref:o})});de.displayName=Me;var le=ne,me=oe,Te=de;const P=p.forwardRef(({className:i,...o},a)=>e.jsx(le,{className:W("grid gap-2",i),...o,ref:a}));P.displayName=le.displayName;const E=p.forwardRef(({className:i,...o},a)=>e.jsx(me,{ref:a,className:W("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...o,children:e.jsx(Te,{className:"flex items-center justify-center",children:e.jsx(Pe,{className:"h-2.5 w-2.5 fill-current text-current"})})}));E.displayName=me.displayName;const Ve=be()(we((i,o)=>({items:[],addItem:a=>i(n=>{const t=n.items.findIndex(r=>r.id===a.id&&r.mall===a.mall);if(t>=0){const r=[...n.items];return r[t].quantity+=1,{items:r}}else return{items:[...n.items,{...a,quantity:1}]}}),removeItem:(a,n)=>i(t=>({items:t.items.filter(r=>!(r.id===a&&r.mall===n))})),updateQuantity:(a,n,t)=>i(r=>n<=0?{items:r.items.filter(c=>!(c.id===a&&c.mall===t))}:{items:r.items.map(c=>c.id===a&&c.mall===t?{...c,quantity:n}:c)}),clearCart:()=>i({items:[]}),getTotalItems:()=>o().items.reduce((n,t)=>n+t.quantity,0),getTotalPrice:()=>o().items.reduce((n,t)=>n+t.price*t.quantity,0),getItemCount:(a,n)=>{const r=o().items.find(d=>d.id===a&&d.mall===n);return r?r.quantity:0}}),{name:"spiral-cart-storage"}));function as(){const[i,o]=p.useState(""),[a,n]=p.useState(""),[t,r]=p.useState("standard"),{toast:d}=Ce();Se();const{items:c,getTotalPrice:u,clearCart:j}=Ve(),h="1",{data:m,isLoading:g}=U({queryKey:["/api/saved-payment-methods",h],queryFn:async()=>{const s=await fetch(`/api/saved-payment-methods/${h}`);if(!s.ok)throw new Error("Failed to load payment methods");return(await s.json()).paymentMethods||[]}}),{data:l,isLoading:v}=U({queryKey:["/api/saved-addresses",h],queryFn:async()=>{const s=await fetch(`/api/saved-addresses/${h}`);if(!s.ok)throw new Error("Failed to load addresses");return(await s.json()).addresses||[]}});p.useEffect(()=>{var s;if(m!=null&&m.length&&!i){const x=m.find(f=>f.isDefault);o((x==null?void 0:x.id)||((s=m[0])==null?void 0:s.id)||"")}},[m,i]),p.useEffect(()=>{var s;if(l!=null&&l.length&&!a){const x=l.find(f=>f.isDefault);n((x==null?void 0:x.id)||((s=l[0])==null?void 0:s.id)||"")}},[l,a]);const y=Ee({mutationFn:async()=>{const s=c.map(f=>({id:f.id,name:f.name,price:f.price,quantity:f.quantity,image:f.image,store:f.store})),x=await fetch("/api/one-click-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h,cartItems:s,paymentMethodId:i,addressId:a,shippingOption:t})});if(!x.ok){const f=await x.json();throw new Error(f.error||"Checkout failed")}return x.json()},onSuccess:s=>{d({title:"Order Completed! ðŸŽ‰",description:`Order ${s.orderId} processed in ${s.processingTime}. You earned ${s.spiralsEarned} SPIRALs!`}),j(),window.location.href=`/order-confirmation?orderId=${s.orderId}`},onError:s=>{d({title:"Checkout Failed",description:s.message,variant:"destructive"})}}),N=()=>{if(!i||!a){d({title:"Missing Information",description:"Please select payment method and shipping address.",variant:"destructive"});return}if(c.length===0){d({title:"Empty Cart",description:"Please add items to your cart before checkout.",variant:"destructive"});return}y.mutate()},R=u(),pe=Math.round(R*20),F=t==="express"?9.99:t==="overnight"?19.99:0,V=R*.0875,z=R+F+V,xe=[{id:"standard",name:"Standard Shipping",description:"5-7 business days",price:0,icon:A},{id:"express",name:"Express Shipping",description:"2-3 business days",price:9.99,icon:Q},{id:"overnight",name:"Overnight Shipping",description:"Next business day",price:19.99,icon:$}],ue=g||v,K=y.isPending;return ue?e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"flex flex-col justify-center items-center h-64 space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"}),e.jsx("p",{className:"text-gray-600",children:"Loading your saved information..."})]})}):c.length===0?e.jsx("div",{className:"container mx-auto p-6 max-w-2xl",children:e.jsx(b,{children:e.jsxs(w,{className:"p-12 text-center",children:[e.jsx(A,{className:"h-16 w-16 mx-auto mb-4 text-gray-400"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add some items to your cart to use one-click checkout."}),e.jsx(Re,{href:"/products",children:e.jsxs(k,{className:"bg-teal-600 hover:bg-teal-700",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Start Shopping"]})})]})})}):e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-teal-600 flex items-center gap-2",children:[e.jsx($,{className:"w-8 h-8 text-yellow-500"}),"One-Click Checkout"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Complete your purchase in seconds with saved payment and shipping information"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(b,{children:[e.jsx(C,{children:e.jsx(S,{children:"Order Items"})}),e.jsx(w,{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"flex gap-4 p-4 border rounded-lg",children:[e.jsx("img",{src:s.image||"/api/placeholder/300/300",alt:s.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.store||"SPIRAL Mall"}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:e.jsxs(O,{className:"bg-orange-100 text-orange-800",children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),"+",Math.round(s.price*s.quantity*20)," SPIRALs"]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:["$",s.price.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Qty: ",s.quantity]})]})]},s.id))})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Payment Method"]})}),e.jsx(w,{children:e.jsx(P,{value:i,onValueChange:o,children:m&&m.length>0?m.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx(E,{value:s.id,id:s.id}),e.jsx(L,{htmlFor:s.id,className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.card?`${s.card.brand.charAt(0).toUpperCase()+s.card.brand.slice(1)} â€¢â€¢â€¢â€¢ ${s.card.last4}`:s.type}),e.jsx("p",{className:"text-sm text-gray-600",children:s.card?`Expires ${s.card.exp_month}/${s.card.exp_year}`:"Saved payment method"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.isDefault&&e.jsxs(O,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Default"]})})]})})]},s.id)):e.jsxs("div",{className:"text-center p-6 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No saved payment methods"}),e.jsx(k,{variant:"outline",size:"sm",children:"Add Payment Method"})]})})})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Shipping Address"]})}),e.jsx(w,{children:e.jsx(P,{value:a,onValueChange:n,children:l&&l.length>0?l.map(s=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50",children:[e.jsx(E,{value:s.id,id:s.id}),e.jsx(L,{htmlFor:s.id,className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.address,", ",s.city,", ",s.state," ",s.zip]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.isDefault&&e.jsxs(O,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Default"]})})]})})]},s.id)):e.jsxs("div",{className:"text-center p-6 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(q,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No saved addresses"}),e.jsx(k,{variant:"outline",size:"sm",children:"Add Address"})]})})})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Shipping Options"]})}),e.jsx(w,{children:e.jsx(P,{value:t,onValueChange:r,children:xe.map(s=>{const x=s.icon;return e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg",children:[e.jsx(E,{value:s.id,id:s.id}),e.jsx(L,{htmlFor:s.id,className:"flex-1 cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description})]})]}),e.jsx("p",{className:"font-medium",children:s.price===0?"Free":`$${s.price}`})]})})]},s.id)})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(C,{children:e.jsx(S,{children:"Order Summary"})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",R.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:F===0?"Free":`$${F.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax"}),e.jsxs("span",{children:["$",V.toFixed(2)]})]}),e.jsx(Ie,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",z.toFixed(2)]})]}),e.jsx("div",{className:"bg-orange-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-orange-800",children:["You'll earn ",pe," SPIRALs with this order!"]})})]})]}),e.jsxs(b,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-green-500"}),"Security Features"]})}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"256-bit SSL encryption"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"PCI DSS compliant"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Fraud protection"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"Purchase protection"})]})]})]}),e.jsx(k,{onClick:N,disabled:K||!i||!a||c.length===0,className:"w-full h-12 text-lg font-semibold bg-gradient-to-r from-teal-600 to-teal-700 hover:from-teal-700 hover:to-teal-800 text-white shadow-lg",size:"lg",children:K?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"Processing Payment..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Complete Order - $",z.toFixed(2)]})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4",children:[e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsx(ke,{className:"w-4 h-4 inline mr-1"}),"Processing in < 2 seconds"]}),e.jsxs("div",{className:"text-center text-sm text-gray-600",children:[e.jsx(Y,{className:"w-4 h-4 inline mr-1"}),"256-bit encrypted"]})]})]})]})]})}export{as as default};
