import{r as i,u as B,j as e,C as a,d as l,s as C,I as E,a as F,b as U,q as z,e as d,P as I,B as x,D as O,v as H,g as q,h as J,i as M}from"./index-sTi6BLPu.js";import{T as X}from"./textarea-DwFaTdzp.js";import{A as S}from"./AdminLayout-Bg0V37d0.js";import{S as $}from"./store-fvM_Wsk5.js";import{U as G}from"./user-DzNM48-o.js";import{F as R}from"./flag-DV31KCjT.js";import{C as j}from"./credit-card-B1A0ZWNg.js";import{S as K}from"./search-BDvTlR0f.js";import{C as Q}from"./circle-x-WVieisiF.js";import{E as V}from"./eye-BfDIBTgL.js";import"./shield-DYGAM3k4.js";import"./house-CU825Ekn.js";import"./users-n91sDYUr.js";import"./bot-oWb1Anye.js";import"./chart-column-DFfP8Ytq.js";function xe(){const[n,p]=i.useState([]),[P,A]=i.useState(!0),[m,T]=i.useState(""),[u,L]=i.useState(null),[f,v]=i.useState(""),{toast:c}=B();i.useEffect(()=>{k()},[]);const k=async()=>{try{const t=await(await fetch("/api/admin/retailers")).json();t.success&&p(t.data)}catch{c({title:"Error Loading Retailers",description:"Failed to fetch retailer data.",variant:"destructive"})}finally{A(!1)}},N=async(s,t)=>{try{(await fetch("/api/admin/update-retailer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:s,status:t})})).ok&&(p(o=>o.map(g=>g.id===s?{...g,status:t}:g)),c({title:"Status Updated",description:`Retailer status changed to ${t}`}))}catch{c({title:"Update Failed",description:"Could not update retailer status.",variant:"destructive"})}},D=async(s,t)=>{try{p(h=>h.map(o=>o.id===s?{...o,notes:t}:o)),c({title:"Notes Saved",description:"Admin notes have been updated."})}catch{c({title:"Save Failed",description:"Could not save admin notes.",variant:"destructive"})}},w=s=>{const t={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",flagged:"bg-orange-100 text-orange-800"};return e.jsx(d,{className:t[s],children:s.charAt(0).toUpperCase()+s.slice(1)})},b=s=>s==="connected"?e.jsxs(d,{className:"bg-green-100 text-green-800",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Connected"]}):s==="pending"?e.jsxs(d,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Pending"]}):e.jsxs(d,{className:"bg-red-100 text-red-800",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Not Connected"]}),y=n.filter(s=>s.storeName.toLowerCase().includes(m.toLowerCase())||s.ownerName.toLowerCase().includes(m.toLowerCase())||s.email.toLowerCase().includes(m.toLowerCase())),r={total:n.length,pending:n.filter(s=>s.status==="pending").length,approved:n.filter(s=>s.status==="approved").length,flagged:n.filter(s=>s.status==="flagged").length,stripeConnected:n.filter(s=>s.stripeStatus==="connected").length};return P?e.jsx(S,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-600"})})}):e.jsx(S,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-teal-600",children:"Retailer Review Panel"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor and manage SPIRAL retailer applications"})]})}),e.jsxs("div",{className:"grid md:grid-cols-5 gap-4",children:[e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Retailers"}),e.jsx("p",{className:"text-2xl font-bold",children:r.total})]}),e.jsx($,{className:"w-8 h-8 text-teal-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:r.pending})]}),e.jsx(G,{className:"w-8 h-8 text-yellow-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Approved"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.approved})]}),e.jsx(C,{className:"w-8 h-8 text-green-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Flagged"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r.flagged})]}),e.jsx(R,{className:"w-8 h-8 text-orange-500"})]})})}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Stripe Connected"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.stripeConnected})]}),e.jsx(j,{className:"w-8 h-8 text-blue-500"})]})})})]}),e.jsx(a,{children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(E,{placeholder:"Search retailers by name, owner, or email...",value:m,onChange:s=>T(s.target.value),className:"pl-10"})]})})}),e.jsxs(a,{children:[e.jsxs(F,{children:[e.jsxs(U,{children:["Retailers (",y.length,")"]}),e.jsx(z,{children:"Review and manage retailer applications and status"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"Store"}),e.jsx("th",{className:"text-left p-3",children:"Owner"}),e.jsx("th",{className:"text-left p-3",children:"Plan"}),e.jsx("th",{className:"text-left p-3",children:"Status"}),e.jsx("th",{className:"text-left p-3",children:"Stripe"}),e.jsx("th",{className:"text-left p-3",children:"Products"}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.storeName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.ownerName}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone})]})}),e.jsx("td",{className:"p-3",children:e.jsx(d,{variant:"outline",children:s.plan})}),e.jsx("td",{className:"p-3",children:w(s.status)}),e.jsx("td",{className:"p-3",children:b(s.stripeStatus)}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-4 h-4 text-gray-400"}),s.productsCount]})}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{size:"sm",variant:"outline",onClick:()=>N(s.id,"approved"),disabled:s.status==="approved",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>N(s.id,"rejected"),disabled:s.status==="rejected",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>N(s.id,"flagged"),disabled:s.status==="flagged",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsxs(O,{children:[e.jsx(H,{asChild:!0,children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{L(s),v(s.notes||"")},children:e.jsx(V,{className:"w-4 h-4"})})}),e.jsxs(q,{className:"max-w-2xl",children:[e.jsx(J,{children:e.jsxs(M,{children:[s.storeName," - Details"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Business Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Store:"})," ",s.storeName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Owner:"})," ",s.ownerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",s.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",s.address]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Platform Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Plan:"}),e.jsx(d,{variant:"outline",children:s.plan})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),w(s.status)]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Stripe:"}),b(s.stripeStatus)]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Products:"}),e.jsx("span",{children:s.productsCount})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Admin Notes"}),e.jsx(X,{placeholder:"Add internal notes about this retailer...",value:f,onChange:t=>v(t.target.value),rows:3}),e.jsx(x,{className:"mt-2",onClick:()=>{u&&D(u.id,f)},children:"Save Notes"})]})]})]})]})]})})]},s.id))})]})})})]})]})})}export{xe as default};
