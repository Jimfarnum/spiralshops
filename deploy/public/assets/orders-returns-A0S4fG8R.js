import{u as J,U as $,r as F,j as e,C as l,a as X,b as W,q as Z,d,L as A,B as n,D as ee,v as se,P as O,g as re,h as ae,i as te,k as ne,G as Y,I as ie,F as le,J as de,K as E,M,e as w,f as B,s as ce}from"./index-sTi6BLPu.js";import{u as V}from"./useQuery-4av79AcX.js";import{u as oe}from"./useMutation-DaiJly-X.js";import{S as k,a as D,b as L,c as q,d as C}from"./select-U2_IWgob.js";import{T as me}from"./textarea-DwFaTdzp.js";import{aN as xe,aO as he,aP as u,aQ as j,aR as p,aS as g,aT as y,aV as U,ar as ue,aF as f,aq as je,a6 as pe,aU as ge}from"./form-MzfRCZUy.js";import{A as ye}from"./arrow-left-DtuWXA6b.js";import{C as fe}from"./credit-card-B1A0ZWNg.js";import{U as Ne}from"./upload-BkvHDh3T.js";import{R as be}from"./refresh-cw-bGZJGN_p.js";import{C as ve}from"./circle-x-WVieisiF.js";import"./index-BdQq_4o_.js";import"./chevron-down-BDj7HIg7.js";import"./check-Cok4To_4.js";import"./label-DXgakF6_.js";function we(){const{data:c,isLoading:S,error:N}=V({queryKey:["/api/auth/user"],queryFn:async()=>{const o=await fetch("/api/auth/user");if(!o.ok){if(o.status===401)return null;throw new Error("Failed to fetch user")}return o.json()},retry:!1,staleTime:3e5});return{user:c,isLoading:S,isAuthenticated:!!c,error:N}}const Ce=ue({orderId:f().min(1,"Please select an order"),productId:f().min(1,"Please select a product"),productName:f().min(1),originalAmount:je().min(0),reason:f().min(10,"Please provide a detailed reason (at least 10 characters)"),refundType:pe(["original","spiral_credit"],{required_error:"Please select a refund method"}),imageUrl:f().optional()}),Se={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",refunded:"bg-blue-100 text-blue-800"},Ie={pending:B,approved:ce,rejected:ve,refunded:Y};function Ke(){const{user:c,isAuthenticated:S}=we(),{toast:N}=J(),o=$(),[b,I]=F.useState(null),[Pe,P]=F.useState(null),[K,m]=F.useState(!1),i=(c==null?void 0:c.id)||"1",a=xe({resolver:ge(Ce),defaultValues:{refundType:"original"}}),{data:t,isLoading:H}=V({queryKey:["/api/returns/eligible-orders",i],queryFn:async()=>{const s=await fetch(`/api/returns/eligible-orders?userId=${i}`);if(!s.ok)throw new Error("Failed to fetch eligible orders");return s.json()},enabled:!!i}),{data:R,isLoading:Q}=V({queryKey:["/api/returns/status",i],queryFn:async()=>{const s=await fetch(`/api/returns/status?userId=${i}`);if(!s.ok)throw new Error("Failed to fetch return history");return s.json()},enabled:!!i}),v=oe({mutationFn:async s=>{const r=await fetch("/api/returns/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...s,userId:i})});if(!r.ok){const h=await r.json();throw new Error(h.message||"Failed to submit return request")}return r.json()},onSuccess:()=>{N({title:"Return Request Submitted",description:"Your return request has been submitted successfully. You'll receive an update soon."}),o.invalidateQueries({queryKey:["/api/returns/status"]}),m(!1),a.reset(),I(null),P(null)},onError:s=>{N({title:"Submission Failed",description:s.message,variant:"destructive"})}}),_=s=>{const r=t==null?void 0:t.find(h=>h.id===s);I(r||null),P(null),a.setValue("orderId",s)},z=s=>{if(!b)return;const r=b.items.find(h=>h.productId===s);P(r||null),r&&(a.setValue("productId",s),a.setValue("productName",r.name),a.setValue("originalAmount",r.price))},G=s=>{v.mutate(s)},x=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s/100),T=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return S?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{href:"/orders",children:e.jsxs(n,{variant:"ghost",size:"sm",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Back to Orders"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Returns & Refunds"}),e.jsx("p",{className:"text-gray-600",children:"Request returns and track refund status"})]})]}),e.jsxs(ee,{open:K,onOpenChange:m,children:[e.jsx(se,{asChild:!0,children:e.jsxs(n,{className:"bg-[#006d77] hover:bg-[#004d55] text-white",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Request Return"]})}),e.jsxs(re,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Request Product Return"}),e.jsx(ne,{children:"Select an eligible order and product to start your return request."})]}),e.jsx(he,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(G),className:"space-y-6",children:[e.jsx(u,{control:a.control,name:"orderId",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Select Order (within 30 days)"}),e.jsxs(k,{onValueChange:r=>{s.onChange(r),_(r)},children:[e.jsx(g,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Choose an eligible order"})})}),e.jsx(q,{children:t==null?void 0:t.map(r=>e.jsxs(C,{value:r.id,children:["Order #",r.id," - ",T(r.createdAt)," (",x(r.totalAmount),")"]},r.id))})]}),e.jsx(y,{})]})}),b&&e.jsx(u,{control:a.control,name:"productId",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Select Product to Return"}),e.jsxs(k,{onValueChange:r=>{s.onChange(r),z(r)},children:[e.jsx(g,{children:e.jsx(D,{children:e.jsx(L,{placeholder:"Choose a product from this order"})})}),e.jsx(q,{children:b.items.map(r=>e.jsxs(C,{value:r.productId,children:[r.name," - ",x(r.price)]},r.productId))})]}),e.jsx(y,{})]})}),e.jsx(u,{control:a.control,name:"reason",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Reason for Return"}),e.jsx(g,{children:e.jsx(me,{placeholder:"Please explain why you're returning this item (damaged, wrong size, not as described, etc.)",className:"min-h-[100px]",...s})}),e.jsx(U,{children:"Provide as much detail as possible to help us process your return quickly."}),e.jsx(y,{})]})}),e.jsx(u,{control:a.control,name:"refundType",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Preferred Refund Method"}),e.jsxs(k,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(g,{children:e.jsx(D,{children:e.jsx(L,{})})}),e.jsxs(q,{children:[e.jsx(C,{value:"original",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Original Payment Method"]})}),e.jsx(C,{value:"spiral_credit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"SPIRAL Credit (+20% bonus value)"]})})]})]}),e.jsx(U,{children:"SPIRAL Credit gives you 20% more value to use at any participating store!"}),e.jsx(y,{})]})}),e.jsx(u,{control:a.control,name:"imageUrl",render:({field:s})=>e.jsxs(j,{children:[e.jsx(p,{children:"Photo (Optional)"}),e.jsx(g,{children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(Ne,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload a photo if the item is damaged or incorrect"}),e.jsx(ie,{type:"url",placeholder:"Or paste image URL here...",className:"mt-2",...s})]})}),e.jsx(U,{children:"Photos help us process returns faster, especially for damaged items."}),e.jsx(y,{})]})}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:v.isPending,children:"Cancel"}),e.jsx(n,{type:"submit",disabled:v.isPending,className:"bg-[#006d77] hover:bg-[#004d55] text-white",children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Return Request"})]})]})})]})]})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs(le,{defaultValue:"history",className:"space-y-6",children:[e.jsxs(de,{className:"grid w-full grid-cols-2",children:[e.jsx(E,{value:"history",children:"Return History"}),e.jsx(E,{value:"eligible",children:"Eligible Orders"})]}),e.jsxs(M,{value:"history",className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Your Return Requests"}),e.jsx("p",{className:"text-gray-600",children:"Track the status of your return and refund requests"})]})}),Q?e.jsx("div",{className:"grid gap-4",children:[1,2,3].map(s=>e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})})},s))}):R&&R.length>0?e.jsx("div",{className:"grid gap-4",children:R.map(s=>{const r=Ie[s.status];return e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.productName}),e.jsxs(w,{className:Se[s.status],children:[e.jsx(r,{className:"h-3 w-3 mr-1"}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),s.autoApproved&&e.jsx(w,{variant:"secondary",children:"Auto-Approved"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Order ID"}),e.jsxs("p",{className:"font-medium",children:["#",s.orderId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Amount"}),e.jsx("p",{className:"font-medium",children:x(s.originalAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Refund Method"}),e.jsx("p",{className:"font-medium",children:s.refundType==="original"?"Original Payment":"SPIRAL Credit"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Submitted"}),e.jsx("p",{className:"font-medium",children:T(s.submittedAt)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Reason:"}),e.jsx("p",{className:"text-sm bg-gray-50 p-3 rounded",children:s.reason})]}),s.decisionNote&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Admin Response:"}),e.jsx("p",{className:"text-sm bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:s.decisionNote})]}),s.imageUrl&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Attached Photo:"}),e.jsx("img",{src:s.imageUrl,alt:"Return request photo",className:"max-w-xs rounded-lg border"})]})]})})})},s.id)})}):e.jsx(l,{children:e.jsxs(d,{className:"p-12 text-center",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Return Requests"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You haven't submitted any return requests yet."}),e.jsxs(n,{onClick:()=>m(!0),className:"bg-[#006d77] hover:bg-[#004d55] text-white",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Request Your First Return"]})]})})]}),e.jsxs(M,{value:"eligible",className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Eligible for Return"}),e.jsx("p",{className:"text-gray-600",children:"Orders from the past 30 days that can be returned"})]})}),H?e.jsx("div",{className:"grid gap-4",children:[1,2].map(s=>e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})})},s))}):t&&t.length>0?e.jsx("div",{className:"grid gap-4",children:t.map(s=>e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Order #",s.id]}),e.jsx(w,{variant:"outline",children:T(s.createdAt)}),e.jsx(w,{className:"bg-green-100 text-green-800",children:"Eligible for Return"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:e.jsxs("p",{children:["Total: ",e.jsx("span",{className:"font-semibold text-gray-900",children:x(s.totalAmount)})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Items in this order:"}),e.jsx("div",{className:"grid gap-2",children:s.items.map(r=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",r.productId]})]}),e.jsx("p",{className:"font-semibold",children:x(r.price)})]},r.id))})]})]}),e.jsx(n,{onClick:()=>{I(s),a.setValue("orderId",s.id),m(!0)},className:"bg-[#006d77] hover:bg-[#004d55] text-white",children:"Return Item"})]})})},s.id))}):e.jsx(l,{children:e.jsxs(d,{className:"p-12 text-center",children:[e.jsx(B,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Eligible Orders"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You don't have any recent orders eligible for return. Orders can be returned within 30 days of purchase."}),e.jsx(A,{href:"/products",children:e.jsx(n,{className:"bg-[#006d77] hover:bg-[#004d55] text-white",children:"Shop Now"})})]})})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs(l,{className:"w-full max-w-md",children:[e.jsxs(X,{children:[e.jsx(W,{children:"Sign In Required"}),e.jsx(Z,{children:"Please sign in to view your orders and manage returns."})]}),e.jsx(d,{children:e.jsx(A,{href:"/api/login",children:e.jsx(n,{className:"w-full",children:"Sign In"})})})]})})}export{Ke as default};
